"""
Society Context for {{ project_name }}.

This module provides the verified multi-agent society infrastructure
for coordinated agent communication.

Generated by Cursor Agent Factory with ASP integration.
Value: 70% less coordination code, audit-ready from day one.

SDG - Love - Truth - Beauty
"""

from lib.society.simple import (
    create_agent_society,
    SimpleSociety,
    SocietyPreset,
    SendResult
)
from lib.society.presets import (
    create_supervisor_worker_society,
    create_peer_society,
    create_pipeline_society,
    TrustTier
)


# Default society configuration for {{ project_name }}
DEFAULT_PRESET = SocietyPreset.{{ society_preset | default('DEVELOPMENT') }}

# Pre-configured society instance
_society: SimpleSociety | None = None


def get_society() -> SimpleSociety:
    """
    Get or create the default society instance.
    
    Returns:
        SimpleSociety configured for {{ project_name }}.
    """
    global _society
    if _society is None:
        _society = create_agent_society(
            name="{{ project_name }}",
            agents={{ initial_agents | default('["orchestrator"]') }},
            preset=DEFAULT_PRESET
        )
    return _society


def reset_society() -> None:
    """Reset the society instance (useful for testing)."""
    global _society
    _society = None


# Quick access functions

def send_verified(
    from_agent: str,
    to_agent: str,
    payload: dict,
    message_type: str = "REQUEST"
) -> SendResult:
    """
    Send a verified message between agents.
    
    Args:
        from_agent: Sender agent ID.
        to_agent: Receiver agent ID.
        payload: Message content.
        message_type: Type of message (REQUEST, INFORM, etc.).
        
    Returns:
        SendResult with verification status.
        
    Example:
        result = send_verified("orchestrator", "worker", {"task": "analyze"})
        if result.verified:
            print("Message verified and delivered")
    """
    society = get_society()
    
    # Auto-register agents if needed
    if from_agent not in society._bridges:
        society.add_agent(from_agent)
    if to_agent not in society._bridges:
        society.add_agent(to_agent)
    
    return society.send(from_agent, to_agent, payload, message_type)


def get_reputation(agent_id: str) -> float:
    """Get the reputation score for an agent."""
    return get_society().get_reputation(agent_id)


def get_trust_level(agent_id: str) -> str:
    """Get the trust level for an agent."""
    return get_society().get_trust_level(agent_id)


def get_audit_log() -> dict:
    """Export the full audit log for compliance."""
    return get_society().export_audit_log()


# Pattern-specific factory functions

def create_{{ project_name | lower | replace(' ', '_') }}_supervisor_society(
    supervisor_id: str = "orchestrator",
    worker_ids: list[str] | None = None
) -> SimpleSociety:
    """
    Create a supervisor-worker society for {{ project_name }}.
    
    Args:
        supervisor_id: ID for the supervisor agent.
        worker_ids: List of worker agent IDs.
        
    Returns:
        Configured SimpleSociety.
    """
    return create_supervisor_worker_society(
        name="{{ project_name }}",
        supervisor_id=supervisor_id,
        worker_ids=worker_ids or ["worker_1", "worker_2"],
        preset=DEFAULT_PRESET
    )
