[pytest]
# Antigravity Agent Factory - Pytest Configuration
# Optimized for FAST collection and error detection

# Add project root to Python path BEFORE test imports (pytest 7+ feature)
# This ensures lib/ package is findable in CI environments
pythonpath = .

# Async test configuration
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Test discovery - optimized for speedtestpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Skip directories that don't contain tests (speeds up collection)
norecursedirs = 
    .git
    .pytest_cache
    __pycache__
    .agent
    node_modules
    data
    dist
    build
    *.egg-info
    fixtures

# Default options for local development - optimized for fast startup
# Keep cache enabled (speeds up repeated runs)
# Disable only heavy plugins that aren't needed locally
addopts = 
    --tb=short
    --strict-markers
    -p no:sugar
    -p no:cov
# Custom markers for intelligent test packaging
markers =
    fast: Fast tests (< 1 second) - run first for quick feedback
    medium: Medium tests (1-10 seconds) - run second
    slow: Slow tests (> 10 seconds) - run last, includes subprocess tests
    integration: Integration tests requiring subprocess execution
    unit: Unit tests - fast, in-process
    validation: Validation tests - fast, schema checking
    cli: CLI tests - slower, subprocess based
    generation: Generation tests - slower, file I/O heavy
    quickstart: QuickStart tests - slowest, full generation workflow

# Timeout settings to prevent hanging tests
timeout = 120
timeout_method = thread

# Parallel execution settings (used with -n auto)
# Workers will be allocated based on CPU cores

# Coverage configuration
[coverage:run]
source = scripts,cli
branch = True
omit = 
    tests/*
    */__pycache__/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise NotImplementedError
