{
  "metadata": {
    "blueprintId": "defi-protocols",
    "blueprintName": "DeFi Protocols Blueprint",
    "description": "Decentralized Finance protocol development with AMMs, lending, staking, and oracles",
    "version": "1.0.0",
    "author": "Antigravity Agent Factory",
    "tags": [
      "solidity",
      "ethereum",
      "defi",
      "amm",
      "lending",
      "staking",
      "smart-contracts"
    ]
  },
  "stack": {
    "primaryLanguage": "solidity",
    "secondaryLanguage": "typescript",
    "frameworks": [
      {
        "name": "Hardhat",
        "version": "2.x",
        "purpose": "Development and testing"
      },
      {
        "name": "Foundry",
        "version": "latest",
        "purpose": "Fuzz testing and fuzzing"
      },
      {
        "name": "OpenZeppelin Contracts",
        "version": "5.x",
        "purpose": "Secure base contracts"
      },
      {
        "name": "Chainlink",
        "version": "2.x",
        "purpose": "Price oracles"
      },
      {
        "name": "ethers.js",
        "version": "6.x",
        "purpose": "Contract interaction"
      },
      {
        "name": "viem",
        "version": "2.x",
        "purpose": "TypeScript client"
      }
    ],
    "databases": [
      {
        "type": "blockchain",
        "name": "Ethereum",
        "purpose": "Mainnet deployment"
      },
      {
        "type": "blockchain",
        "name": "Arbitrum",
        "purpose": "L2 deployment"
      },
      {
        "type": "blockchain",
        "name": "Base",
        "purpose": "L2 deployment"
      },
      {
        "type": "indexer",
        "name": "The Graph",
        "purpose": "Event indexing"
      }
    ],
    "tools": [
      {
        "name": "Slither",
        "purpose": "Static security analysis"
      },
      {
        "name": "Mythril",
        "purpose": "Symbolic execution"
      },
      {
        "name": "Echidna",
        "purpose": "Property-based fuzzing"
      },
      {
        "name": "Certora",
        "purpose": "Formal verification",
        "optional": true
      },
      {
        "name": "Tenderly",
        "purpose": "Simulation and debugging"
      }
    ],
    "styleGuides": [
      {
        "name": "solidity-style-guide",
        "description": "Official Solidity Style Guide"
      },
      {
        "name": "openzeppelin-style",
        "description": "OpenZeppelin conventions"
      }
    ]
  },
  "agents": [
    {
      "patternId": "code-reviewer",
      "required": true,
      "customizations": {
        "skills": [
          "smart-contract-audit",
          "grounding"
        ]
      }
    },
    {
      "patternId": "security-auditor",
      "required": true,
      "customizations": {
        "focus": "defi-security"
      }
    },
    {
      "patternId": "test-generator",
      "required": true,
      "customizations": {
        "skills": [
          "smart-contract-testing"
        ]
      }
    },
    {
      "patternId": "explorer",
      "required": false,
      "customizations": {
        "focus": "defi-protocols"
      }
    },
    {
      "patternId": "knowledge-extender",
      "required": true,
      "description": "Extend knowledge base during development"
    },
    {
      "patternId": "knowledge-evolution",
      "required": true,
      "description": "Manage and evolve project knowledge independently"
    },
    {
      "patternId": "factory-updates",
      "required": true,
      "description": "Receive updates from the Antigravity Agent Factory"
    },
    {
      "patternId": "debug-conductor-project",
      "required": false,
      "description": "Autonomous debugging agent for CI/CD and test failures"
    }
  ],
  "skills": [
    {
      "patternId": "smart-contract-audit",
      "required": true
    },
    {
      "patternId": "smart-contract-testing",
      "required": true
    },
    {
      "patternId": "gas-optimization",
      "required": true
    },
    {
      "patternId": "bugfix-workflow",
      "required": true
    },
    {
      "patternId": "feature-workflow",
      "required": true
    },
    {
      "patternId": "grounding",
      "required": true
    },
    {
      "patternId": "grounding-verification",
      "required": true,
      "default": true,
      "description": "Two-pass verification for LLM grounding and factual claims"
    },
    {
      "patternId": "alignment-check",
      "required": true,
      "default": true,
      "description": "Verify understanding before major implementations"
    },
    {
      "patternId": "research-first-project",
      "required": true,
      "default": true,
      "description": "Research existing solutions before building"
    },
    {
      "patternId": "tdd",
      "required": true
    },
    {
      "patternId": "extend-knowledge",
      "required": true,
      "description": "Extend knowledge base with new topics"
    },
    {
      "patternId": "receive-updates",
      "required": true,
      "description": "Receive updates from Factory"
    },
    {
      "patternId": "ci-monitor-project",
      "required": false,
      "default": true,
      "description": "Monitor CI/CD pipelines with automatic error detection"
    },
    {
      "patternId": "pipeline-error-fix-project",
      "required": false,
      "default": true,
      "description": "Systematic pipeline error detection and fixing"
    }
  ],
  "testingApproach": {
    "modes": [
      "invariant-testing",
      "fuzz-testing",
      "fork-testing"
    ],
    "default": "invariant-testing",
    "frameworks": {
      "unit": "forge-test",
      "fuzz": "forge-fuzz",
      "invariant": "forge-invariant",
      "fork": "forge-fork"
    },
    "requirements": {
      "fuzz_runs": 10000,
      "invariant_runs": 1000,
      "coverage": "95%"
    }
  },
  "knowledge": [
    {
      "filename": "defi-patterns.json",
      "description": "DeFi protocol design patterns"
    },
    {
      "filename": "ethereum-security.json",
      "description": "Security vulnerabilities"
    },
    {
      "filename": "solidity-patterns.json",
      "description": "Smart contract patterns"
    },
    {
      "filename": "erc-standards.json",
      "description": "ERC token standards"
    }
  ],
  "templates": {
    "codeTemplates": [
      {
        "category": "amm-pool",
        "directory": "templates/solidity/contracts/defi/"
      },
      {
        "category": "lending-pool",
        "directory": "templates/solidity/contracts/defi/"
      },
      {
        "category": "staking-contract",
        "directory": "templates/solidity/contracts/defi/"
      },
      {
        "category": "vault",
        "directory": "templates/solidity/contracts/defi/"
      },
      {
        "category": "erc20-token",
        "directory": "templates/solidity/contracts/"
      },
      {
        "category": "unit-test",
        "directory": "templates/solidity/test/"
      }
    ],
    "documentTemplates": [
      {
        "name": "protocol_spec.md",
        "directory": "templates/docs/"
      },
      {
        "name": "security_audit.md",
        "directory": "templates/docs/"
      },
      {
        "name": "tokenomics.md",
        "directory": "templates/docs/"
      }
    ]
  },
  "workflows": [
    {
      "patternId": "defi-development",
      "customizations": {}
    },
    {
      "patternId": "security-audit-workflow",
      "customizations": {}
    },
    {
      "patternId": "deployment-workflow",
      "customizations": {}
    }
  ],
  "mcpServers": [
    {
      "name": "deepwiki",
      "url": "https://mcp.deepwiki.com/mcp",
      "purpose": "DeFi documentation",
      "required": true
    }
  ],
  "projectStructure": {
    "directories": [
      {
        "path": ".agent/agents/",
        "purpose": "AI agent definitions"
      },
      {
        "path": ".agent/skills/",
        "purpose": "Reusable skills"
      },
      {
        "path": "contracts/",
        "purpose": "Smart contracts"
      },
      {
        "path": "contracts/core/",
        "purpose": "Core protocol contracts"
      },
      {
        "path": "contracts/periphery/",
        "purpose": "Helper contracts"
      },
      {
        "path": "contracts/interfaces/",
        "purpose": "Contract interfaces"
      },
      {
        "path": "contracts/libraries/",
        "purpose": "Shared libraries"
      },
      {
        "path": "contracts/mocks/",
        "purpose": "Mock contracts for testing"
      },
      {
        "path": "test/",
        "purpose": "Test files"
      },
      {
        "path": "test/unit/",
        "purpose": "Unit tests"
      },
      {
        "path": "test/integration/",
        "purpose": "Integration tests"
      },
      {
        "path": "test/invariant/",
        "purpose": "Invariant tests"
      },
      {
        "path": "test/fork/",
        "purpose": "Fork tests"
      },
      {
        "path": "scripts/",
        "purpose": "Deployment scripts"
      },
      {
        "path": "subgraph/",
        "purpose": "The Graph indexer"
      },
      {
        "path": "docs/",
        "purpose": "Documentation"
      }
    ],
    "files": [
      {
        "path": ".agentrules",
        "purpose": "Agent behavior rules"
      },
      {
        "path": "hardhat.config.ts",
        "purpose": "Hardhat configuration"
      },
      {
        "path": "foundry.toml",
        "purpose": "Foundry configuration"
      },
      {
        "path": "package.json",
        "purpose": "NPM dependencies"
      }
    ]
  },
  "agentrules": {
    "variables": [
      {
        "name": "SOLIDITY_VERSION",
        "default": "0.8.24"
      },
      {
        "name": "CHAIN_ID",
        "default": "1"
      },
      {
        "name": "ORACLE_PROVIDER",
        "default": "chainlink"
      }
    ],
    "rules": [
      {
        "name": "Security First",
        "description": "Use audited libraries, follow CEI pattern"
      },
      {
        "name": "Oracle Safety",
        "description": "Always validate oracle data freshness and price bounds"
      },
      {
        "name": "Reentrancy",
        "description": "Use ReentrancyGuard on all external-calling functions"
      },
      {
        "name": "Access Control",
        "description": "Implement proper role-based access control"
      },
      {
        "name": "Events",
        "description": "Emit events for all state changes"
      },
      {
        "name": "Invariant Tests",
        "description": "Write invariant tests for all protocol properties"
      },
      {
        "name": "Flash Loan Protection",
        "description": "Consider same-block manipulation attacks"
      }
    ]
  },
  "defiPatterns": {
    "core": [
      "AMM",
      "Lending",
      "Staking",
      "Vault"
    ],
    "advanced": [
      "Flash Loans",
      "Liquidations",
      "Governance",
      "Oracles"
    ],
    "security": [
      "Reentrancy Guard",
      "Price Manipulation Protection",
      "Access Control"
    ]
  },
  "securityChecklist": {
    "mandatory": [
      "Reentrancy protection on all external calls",
      "Oracle staleness and manipulation checks",
      "Slippage protection for swaps",
      "Flash loan attack resistance",
      "Access control on admin functions",
      "Invariant tests for core properties"
    ],
    "recommended": [
      "Formal verification for critical math",
      "Third-party security audit",
      "Bug bounty program",
      "Timelock on admin functions"
    ]
  },
  "pmIntegration": {
    "enabled": false,
    "description": "Optional project management integration with agile workflows",
    "agents": [
      {"patternId": "product-owner", "description": "Creates and refines stories, prioritizes backlog"},
      {"patternId": "sprint-master", "description": "Facilitates sprint ceremonies and removes blockers"},
      {"patternId": "task-manager", "description": "Breaks stories into tasks, manages issues"},
      {"patternId": "reporting-agent", "description": "Generates metrics, burndowns, dashboards"}
    ],
    "skills": [
      {"patternId": "create-story", "description": "Create user stories with acceptance criteria"},
      {"patternId": "create-epic", "description": "Create epics with child story structure"},
      {"patternId": "create-task", "description": "Create implementation tasks"},
      {"patternId": "plan-sprint", "description": "Sprint planning workflow"},
      {"patternId": "run-standup", "description": "Daily standup facilitation"},
      {"patternId": "close-sprint", "description": "Sprint closure and velocity calculation"}
    ],
    "backends": ["github", "jira", "linear", "azure-devops"]
  }
}
