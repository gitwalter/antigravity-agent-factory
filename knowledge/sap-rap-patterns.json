{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "id": "sap-rap-patterns",
  "name": "SAP RAP Patterns",
  "version": "1.0.0",
  "description": "Patterns and best practices for RESTful ABAP Programming Model (RAP) business object development",
  "category": "sap",
  "last_updated": "2026-02-09",
  "axiomAlignment": {
    "love": "Empower developers with clear, reusable patterns that reduce complexity",
    "truth": "Based on official SAP RAP documentation and proven practices",
    "beauty": "Clean, maintainable code structures that follow ABAP Cloud principles"
  },
  "patterns": {
    "rap-managed-bo": {
      "id": "rap-managed-bo",
      "name": "Managed RAP Business Object",
      "description": "Standard managed RAP BO pattern with framework-managed CRUD operations",
      "scenario": "New business objects with standard CRUD requirements",
      "code": {
        "bdef": "managed implementation in class zbp_i_entity unique;\nstrict ( 2 );\nwith draft;\n\ndefine behavior for ZI_Entity alias Entity\npersistent table zentity\ndraft table zentity_d\nlock master total etag LastChangedAt\nauthorization master ( instance )\n{\n  field ( readonly ) EntityUUID, CreatedBy, CreatedAt;\n  field ( mandatory ) Description;\n  create;\n  update;\n  delete;\n}"
      },
      "bestPractices": [
        "Use managed BOs for new business objects",
        "Enable draft handling for complex editing scenarios",
        "Use total ETag (LastChangedAt) for optimistic locking",
        "Implement instance-level authorization for sensitive data"
      ]
    },
    "rap-unmanaged-bo": {
      "id": "rap-unmanaged-bo",
      "name": "Unmanaged RAP Business Object",
      "description": "Unmanaged RAP BO with developer-implemented CRUD operations",
      "scenario": "Legacy tables or custom CRUD logic requirements",
      "code": {
        "bdef": "unmanaged implementation in class zbp_i_entity unique;\nstrict ( 2 );\n\ndefine behavior for ZI_Entity alias Entity\npersistent table zentity\n{\n  field ( readonly ) EntityUUID;\n  field ( mandatory ) Description;\n  create;\n  update;\n  delete;\n  \n  mapping for zentity\n  corresponding\n  {\n    EntityUUID = entity_uuid;\n    Description = description;\n  }\n}"
      },
      "bestPractices": [
        "Use unmanaged BOs only when necessary (legacy tables)",
        "Implement all CRUD operations manually",
        "Handle locking and authorization explicitly",
        "Map fields correctly in behavior definition"
      ]
    },
    "rap-abstract-entity": {
      "id": "rap-abstract-entity",
      "name": "Abstract RAP Entity",
      "description": "Read-only abstract entity for reporting and analytics",
      "scenario": "Query-only scenarios without persistent data",
      "code": {
        "cds": "define abstract entity ZA_Entity\n{\n  key EntityUUID : sysuuid_x16;\n  Description : abap.char(255);\n  Status : abap.char(1);\n}\n\ndefine view entity ZI_Entity\n  as projection on zentity\n  implements ZA_Entity\n{\n  key entity_uuid as EntityUUID,\n      description as Description,\n      status as Status\n}"
      },
      "bestPractices": [
        "Use abstract entities for read-only scenarios",
        "Implement abstract entity interface",
        "No CRUD operations needed",
        "Perfect for analytics and reporting"
      ]
    },
    "rap-draft-handling": {
      "id": "rap-draft-handling",
      "name": "Draft Handling Pattern",
      "description": "Enable draft handling for multi-session editing with ETag support",
      "scenario": "Complex business objects requiring draft functionality",
      "code": {
        "bdef": "with draft;\n\ndefine behavior for ZI_Entity alias Entity\npersistent table zentity\ndraft table zentity_d\nlock master total etag LastChangedAt\n{\n  draft action Resume;\n  draft action Edit;\n  draft action Activate;\n  draft action Discard;\n}"
      },
      "bestPractices": [
        "Enable draft for complex editing scenarios",
        "Use total ETag for optimistic locking",
        "Implement draft actions (Resume, Edit, Activate, Discard)",
        "Handle draft validation separately"
      ]
    },
    "rap-determination": {
      "id": "rap-determination",
      "name": "Determination Pattern",
      "description": "Automatic field calculation and side effects",
      "scenario": "Calculated fields, numbering, default values",
      "code": {
        "bdef": "determination setEntityID on modify { create; }\ndetermination calculateTotal on modify { create; update; }",
        "implementation": "METHOD setEntityID.\n  \" Read entities\n  READ ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity FIELDS ( EntityID )\n    WITH CORRESPONDING #( keys )\n    RESULT DATA(entities).\n  \n  \" Set entity ID\n  LOOP AT entities ASSIGNING FIELD-SYMBOL(<entity>).\n    <entity>-EntityID = get_next_number( ).\n  ENDLOOP.\n  \n  \" Modify entities\n  MODIFY ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity UPDATE FIELDS ( EntityID )\n    WITH CORRESPONDING #( entities ).\nENDMETHOD."
      },
      "bestPractices": [
        "Use determinations for calculated fields",
        "Trigger on appropriate events (create, update)",
        "Avoid side effects in determinations",
        "Use for numbering and default values"
      ]
    },
    "rap-validation": {
      "id": "rap-validation",
      "name": "Validation Pattern",
      "description": "Business rule validation before save",
      "scenario": "Data validation, business rule enforcement",
      "code": {
        "bdef": "validation validateDates on save { create; update; }",
        "implementation": "METHOD validateDates.\n  READ ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity FIELDS ( BeginDate EndDate )\n    WITH CORRESPONDING #( keys )\n    RESULT DATA(entities).\n  \n  LOOP AT entities ASSIGNING FIELD-SYMBOL(<entity>).\n    IF <entity>-EndDate < <entity>-BeginDate.\n      APPEND VALUE #( EntityUUID = <entity>-EntityUUID ) TO failed-entity.\n      APPEND VALUE #( EntityUUID = <entity>-EntityUUID\n                      %msg = new_message( id = 'ZENTITY'\n                                         number = '001'\n                                         severity = if_abap_behv_message=>severity-error )\n                      %element-BeginDate = if_abap_behv=>mk-on\n                      %element-EndDate = if_abap_behv=>mk-on ) TO reported-entity.\n    ENDIF.\n  ENDLOOP.\nENDMETHOD."
      },
      "bestPractices": [
        "Use validations for business rules",
        "Validate on save (create, update)",
        "Provide clear error messages",
        "Mark fields with errors using %element"
      ]
    },
    "rap-action": {
      "id": "rap-action",
      "name": "Action Pattern",
      "description": "Custom business operations beyond CRUD",
      "scenario": "Approval workflows, status changes, complex operations",
      "code": {
        "bdef": "action ( features : instance ) submit result [1] $self;\naction ( features : instance ) cancel result [1] $self;",
        "implementation": "METHOD submit.\n  READ ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity ALL FIELDS\n    WITH CORRESPONDING #( keys )\n    RESULT DATA(entities).\n  \n  LOOP AT entities ASSIGNING FIELD-SYMBOL(<entity>).\n    <entity>-Status = 'S'.\n  ENDLOOP.\n  \n  MODIFY ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity UPDATE FIELDS ( Status )\n    WITH CORRESPONDING #( entities ).\n  \n  result = VALUE #( FOR entity IN entities\n                    ( EntityUUID = entity-EntityUUID\n                      %param = entity ) ).\nENDMETHOD."
      },
      "bestPractices": [
        "Use actions for complex operations",
        "Return result entity for UI updates",
        "Use features: instance for instance-level actions",
        "Implement proper error handling"
      ]
    },
    "rap-authorization-instance": {
      "id": "rap-authorization-instance",
      "name": "Instance-Level Authorization",
      "description": "Record-level authorization control",
      "scenario": "Sensitive data requiring record-level access control",
      "code": {
        "bdef": "authorization master ( instance )",
        "implementation": "METHOD get_instance_authorizations.\n  READ ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity ALL FIELDS\n    WITH CORRESPONDING #( keys )\n    RESULT DATA(entities).\n  \n  LOOP AT entities INTO DATA(entity).\n    AUTHORITY-CHECK OBJECT 'ZENTITY'\n      ID 'ACTVT' FIELD '02'\n      ID 'AGENCYID' FIELD entity-AgencyID.\n    \n    IF sy-subrc = 0.\n      result = VALUE #( ( EntityUUID = entity-EntityUUID\n                         %update = if_abap_behv=>auth-allowed\n                         %delete = if_abap_behv=>auth-allowed ) ).\n    ELSE.\n      result = VALUE #( ( EntityUUID = entity-EntityUUID\n                         %update = if_abap_behv=>auth-unauthorized\n                         %delete = if_abap_behv=>auth-unauthorized ) ).\n    ENDIF.\n  ENDLOOP.\nENDMETHOD."
      },
      "bestPractices": [
        "Use instance authorization for sensitive data",
        "Check authorization in get_instance_authorizations",
        "Return auth-allowed or auth-unauthorized",
        "Combine with DCL rules for field-level security"
      ]
    },
    "rap-numbering": {
      "id": "rap-numbering",
      "name": "Numbering Pattern",
      "description": "Automatic number assignment using number ranges",
      "scenario": "Business document numbering",
      "code": {
        "implementation": "METHOD setEntityID.\n  READ ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity FIELDS ( EntityID )\n    WITH CORRESPONDING #( keys )\n    RESULT DATA(entities).\n  \n  DATA(number_range) = cl_numberrange_runtime=>number_get(\n    exporting\n      nr_range_nr = '01'\n      object      = 'ZENTITY'\n      quantity    = lines( entities )\n  ).\n  \n  LOOP AT entities ASSIGNING FIELD-SYMBOL(<entity>).\n    <entity>-EntityID = number_range-number.\n    number_range-number = number_range-number + 1.\n  ENDLOOP.\n  \n  MODIFY ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity UPDATE FIELDS ( EntityID )\n    WITH CORRESPONDING #( entities ).\nENDMETHOD."
      },
      "bestPractices": [
        "Use number ranges for document numbering",
        "Get numbers in batch for performance",
        "Set field as readonly after creation",
        "Handle number range errors gracefully"
      ]
    },
    "rap-side-effects": {
      "id": "rap-side-effects",
      "name": "Side Effects Pattern",
      "description": "Update related entities when parent changes",
      "scenario": "Cascading updates, calculated totals",
      "code": {
        "bdef": "determination calculateTotal on modify { create; update; }\nassociation _Items { create; update; delete; }",
        "implementation": "METHOD calculateTotal.\n  READ ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity ALL FIELDS\n    WITH CORRESPONDING #( keys )\n    RESULT DATA(entities).\n  \n  READ ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity BY \\_Items\n    ALL FIELDS WITH CORRESPONDING #( keys )\n    RESULT DATA(items).\n  \n  LOOP AT entities ASSIGNING FIELD-SYMBOL(<entity>).\n    DATA(total) = <entity>-BaseAmount.\n    LOOP AT items INTO DATA(item) WHERE EntityUUID = <entity>-EntityUUID.\n      total = total + item-Amount.\n    ENDLOOP.\n    <entity>-TotalAmount = total.\n  ENDLOOP.\n  \n  MODIFY ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity UPDATE FIELDS ( TotalAmount )\n    WITH CORRESPONDING #( entities ).\nENDMETHOD."
      },
      "bestPractices": [
        "Use side effects for calculated totals",
        "Read related entities efficiently",
        "Update parent when child changes",
        "Avoid circular dependencies"
      ]
    },
    "rap-composition": {
      "id": "rap-composition",
      "name": "Composition Pattern",
      "description": "Parent-child relationship with dependent entities",
      "scenario": "Header-item structures, dependent data",
      "code": {
        "cds": "define root view entity ZI_Entity\n  as select from zentity\n  composition [0..*] of ZI_EntityItem as _Items\n{\n  key EntityUUID,\n      Description,\n      _Items\n}\n\ndefine view entity ZI_EntityItem\n  as select from zentityitem\n  association [0..1] to ZI_Entity as _Entity\n    on $projection.EntityUUID = _Entity.EntityUUID\n{\n  key EntityUUID,\n  key ItemUUID,\n      Description,\n      _Entity\n}",
        "bdef": "association _Items { create; update; delete; }"
      },
      "bestPractices": [
        "Use composition for dependent entities",
        "Child cannot exist without parent",
        "Handle cascade delete properly",
        "Use associations for reference data"
      ]
    },
    "rap-etag-optimistic-lock": {
      "id": "rap-etag-optimistic-lock",
      "name": "ETag Optimistic Locking",
      "description": "Prevent concurrent modification conflicts",
      "scenario": "Multi-user editing scenarios",
      "code": {
        "bdef": "lock master total etag LastChangedAt",
        "table": "last_changed_at : timestampl;"
      },
      "bestPractices": [
        "Use total ETag for optimistic locking",
        "Update LastChangedAt on every modification",
        "Handle ETag conflicts gracefully",
        "Use draft for complex editing scenarios"
      ]
    },
    "rap-field-control": {
      "id": "rap-field-control",
      "name": "Field Control Pattern",
      "description": "Dynamic field visibility and editability",
      "scenario": "Conditional field display, status-based control",
      "code": {
        "bdef": "field ( readonly ) EntityUUID, CreatedBy, CreatedAt;\nfield ( readonly : update ) EntityID;\nfield ( mandatory ) Description;",
        "implementation": "METHOD get_control.\n  READ ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity FIELDS ( Status Description )\n    WITH CORRESPONDING #( keys )\n    RESULT DATA(entities).\n  \n  LOOP AT entities INTO DATA(entity).\n    IF entity-Status = 'C'.\n      result = VALUE #( ( EntityUUID = entity-EntityUUID\n                         %control-Description = if_abap_behv=>mk-on ) ).\n    ELSE.\n      result = VALUE #( ( EntityUUID = entity-EntityUUID\n                         %control-Description = if_abap_behv=>mk-off ) ).\n    ENDIF.\n  ENDLOOP.\nENDMETHOD."
      },
      "bestPractices": [
        "Use field control for dynamic UI",
        "Set readonly for system fields",
        "Use readonly: update for fields editable only on create",
        "Implement get_control for dynamic control"
      ]
    },
    "rap-service-binding": {
      "id": "rap-service-binding",
      "name": "Service Binding Pattern",
      "description": "Expose RAP BO as OData V4 service",
      "scenario": "Fiori Elements apps, external integrations",
      "code": {
        "service": "@EndUserText.label: 'Entity Service'\ndefine service ZUI_ENTITY_O4 {\n  expose ZC_Entity as Entity;\n  expose ZC_EntityItem as EntityItem;\n}"
      },
      "bestPractices": [
        "Create service definition before binding",
        "Use consumption views (C_) in service",
        "Activate service before testing",
        "Test with /IWFND/V4_ADMIN"
      ]
    },
    "rap-i-cds-views": {
      "id": "rap-i-cds-views",
      "name": "I_ and C_ CDS Views Pattern",
      "description": "Standard CDS view naming and structure",
      "scenario": "All RAP BO development",
      "code": {
        "i_view": "@EndUserText.label: 'Entity Interface'\ndefine view entity ZI_Entity\n  as select from zentity\n{\n  key EntityUUID,\n      Description\n}",
        "c_view": "@EndUserText.label: 'Entity Consumption'\ndefine view entity ZC_Entity\n  as projection on ZI_Entity\n{\n  key EntityUUID,\n      Description,\n      @UI.lineItem: [{ position: 10 }]\n      Description\n}"
      },
      "bestPractices": [
        "Use I_ prefix for interface views",
        "Use C_ prefix for consumption views",
        "Interface views contain data model",
        "Consumption views contain UI annotations"
      ]
    },
    "rap-error-handling": {
      "id": "rap-error-handling",
      "name": "Error Handling Pattern",
      "description": "Proper error messages and validation feedback",
      "scenario": "All validation and error scenarios",
      "code": {
        "implementation": "APPEND VALUE #( EntityUUID = entity-EntityUUID ) TO failed-entity.\nAPPEND VALUE #( EntityUUID = entity-EntityUUID\n                %msg = new_message( id = 'ZENTITY'\n                                   number = '001'\n                                   severity = if_abap_behv_message=>severity-error\n                                   v1 = |Error message| )\n                %element-FieldName = if_abap_behv=>mk-on ) TO reported-entity."
      },
      "bestPractices": [
        "Always add to failed table",
        "Provide clear error messages",
        "Mark fields with errors using %element",
        "Use appropriate severity levels"
      ]
    },
    "rap-authorization-global": {
      "id": "rap-authorization-global",
      "name": "Global Authorization Pattern",
      "description": "Entity-level authorization without instance checks",
      "scenario": "Simple authorization requirements",
      "code": {
        "bdef": "authorization master",
        "dcl": "@EndUserText.label: 'Entity Access Control'\ndefine role ZC_Entity {\n  grant select on ZI_Entity\n    where ( CreatedBy ) = aspect user_filter( CreatedBy );\n}"
      },
      "bestPractices": [
        "Use global authorization for simple cases",
        "Combine with DCL rules",
        "Use user_filter for user-specific data",
        "Implement instance authorization for sensitive data"
      ]
    },
    "rap-validation-early": {
      "id": "rap-validation-early",
      "name": "Early Validation Pattern",
      "description": "Validate in determination before save",
      "scenario": "Prevent invalid data early",
      "code": {
        "bdef": "determination validateDates on modify { create; update; }",
        "implementation": "METHOD validateDates.\n  \" Validate and set error if invalid\n  \" This runs before validation phase\nENDMETHOD."
      },
      "bestPractices": [
        "Use determinations for early validation",
        "Set errors in determination phase",
        "Prevent invalid data early",
        "Use validations for final checks"
      ]
    },
    "rap-bulk-operations": {
      "id": "rap-bulk-operations",
      "name": "Bulk Operations Pattern",
      "description": "Efficient handling of multiple entities",
      "scenario": "Batch processing, bulk updates",
      "code": {
        "implementation": "METHOD update.\n  \" Read all entities at once\n  READ ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity ALL FIELDS\n    WITH CORRESPONDING #( keys )\n    RESULT DATA(entities).\n  \n  \" Process in bulk\n  LOOP AT entities ASSIGNING FIELD-SYMBOL(<entity>).\n    \" Process entity\n  ENDLOOP.\n  \n  \" Modify all at once\n  MODIFY ENTITIES OF ZI_Entity IN LOCAL MODE\n    ENTITY Entity UPDATE FIELDS ( Field1 Field2 )\n    WITH CORRESPONDING #( entities ).\nENDMETHOD."
      },
      "bestPractices": [
        "Read entities in bulk",
        "Process in loops efficiently",
        "Modify entities in bulk",
        "Avoid individual database calls"
      ]
    },
    "rap-custom-entities": {
      "id": "rap-custom-entities",
      "name": "Custom Entities Pattern",
      "description": "Entities without database table mapping",
      "scenario": "Calculated data, virtual entities",
      "code": {
        "cds": "define custom entity ZCE_Entity {\n  key EntityUUID : sysuuid_x16;\n  Description : abap.char(255);\n  CalculatedField : abap.int4;\n}"
      },
      "bestPractices": [
        "Use custom entities for calculated data",
        "No persistent storage",
        "Implement in behavior implementation",
        "Use for analytics and reporting"
      ]
    }
  },
  "commonTables": {
    "i_views": "Interface views (I_*) - Data model layer",
    "c_views": "Consumption views (C_*) - UI layer with annotations",
    "draft_tables": "Draft tables (*_d) - Draft data storage",
    "persistent_tables": "Persistent tables (z*) - Actual data storage"
  },
  "best_practices": [
    "Always use managed BOs unless legacy tables require unmanaged",
    "Enable draft handling for complex editing scenarios",
    "Use total ETag (LastChangedAt) for optimistic locking",
    "Implement instance-level authorization for sensitive data",
    "Use determinations for calculated fields and side effects",
    "Use validations for business rule enforcement",
    "Use actions for complex operations beyond CRUD",
    "Follow naming conventions: ZI_ for interface, ZC_ for consumption",
    "Use semantic annotations (@EndUserText.label) for all entities",
    "Implement proper error handling with messages",
    "Use associations for related data",
    "Configure proper field control (readonly, mandatory)"
  ],
  "anti_patterns": [
    {
      "name": "Using unmanaged when managed would work",
      "problem": "Adds unnecessary complexity and code",
      "solution": "Use managed BOs for new business objects"
    },
    {
      "name": "Missing draft handling for complex processes",
      "problem": "Causes concurrency issues and data loss",
      "solution": "Enable draft handling for multi-step processes"
    },
    {
      "name": "Not using ETag for optimistic locking",
      "problem": "Causes data loss in concurrent editing",
      "solution": "Always use total ETag (LastChangedAt)"
    },
    {
      "name": "Missing authorization checks",
      "problem": "Security vulnerability",
      "solution": "Implement instance-level authorization"
    }
  ]
}