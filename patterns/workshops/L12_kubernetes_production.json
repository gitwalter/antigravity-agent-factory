{
  "$schema": "../learning-workshop-pattern.json",
  "workshopId": "L12_kubernetes_production",
  "name": "Kubernetes Production Deployments",
  "technology": {
    "category": "cloud_native",
    "stack": "Kubernetes",
    "language": "YAML",
    "version": "Kubernetes 1.28+"
  },
  "level": "intermediate",
  "prerequisites": {
    "workshops": [],
    "knowledge": [
      "Container concepts (Docker)",
      "Basic Linux commands",
      "YAML syntax",
      "Networking fundamentals"
    ],
    "tools": [
      "kubectl",
      "minikube or kind (local cluster)",
      "VS Code with YAML extension",
      "Docker"
    ]
  },
  "duration": {
    "total_hours": 2.5,
    "concept_minutes": 30,
    "demo_minutes": 30,
    "exercise_minutes": 45,
    "challenge_minutes": 30,
    "reflection_minutes": 15
  },
  "learning_objectives": [
    {
      "objective": "Understand Kubernetes core concepts: Pods, Deployments, Services",
      "bloom_level": "understand",
      "verification": "Can explain the relationship between Pods, Deployments, and Services"
    },
    {
      "objective": "Create and manage Deployments for application scaling",
      "bloom_level": "apply",
      "verification": "Creates Deployments with proper configuration and scaling"
    },
    {
      "objective": "Configure Services for internal and external access",
      "bloom_level": "apply",
      "verification": "Sets up ClusterIP, NodePort, and LoadBalancer services"
    },
    {
      "objective": "Manage configuration with ConfigMaps and Secrets",
      "bloom_level": "apply",
      "verification": "Creates and uses ConfigMaps and Secrets in deployments"
    },
    {
      "objective": "Implement observability with logging and monitoring",
      "bloom_level": "apply",
      "verification": "Sets up logging and basic monitoring for applications"
    }
  ],
  "knowledge_files": [
    "kubernetes-patterns.json",
    "docker-patterns.json"
  ],
  "phases": [
    {
      "phaseId": "concept",
      "name": "Kubernetes Architecture and Core Concepts",
      "type": "concept",
      "duration_minutes": 30,
      "description": "Understanding Kubernetes architecture and core resources",
      "content": {
        "topics": [
          "Kubernetes architecture: control plane and nodes",
          "Pods: smallest deployable unit",
          "Deployments: managing Pod replicas",
          "Services: networking and load balancing",
          "ConfigMaps and Secrets: configuration management",
          "Scaling: horizontal and vertical",
          "Observability: logs, metrics, health checks"
        ],
        "diagrams": [
          "Kubernetes cluster architecture",
          "Pod lifecycle",
          "Deployment and ReplicaSet relationship",
          "Service types and networking",
          "ConfigMap and Secret usage"
        ],
        "key_points": [
          "Pods are ephemeral; use Deployments for persistence",
          "Services provide stable networking",
          "ConfigMaps for non-sensitive config, Secrets for sensitive",
          "Health checks ensure reliability",
          "Scaling can be manual or automatic"
        ]
      },
      "facilitator_notes": "Emphasize the declarative nature of Kubernetes. Show how resources relate to each other.",
      "common_questions": [
        "What's the difference between a Pod and a Deployment?",
        "When should I use different Service types?",
        "How do ConfigMaps and Secrets work?"
      ]
    },
    {
      "phaseId": "demo",
      "name": "Deploying a Web Application",
      "type": "demo",
      "duration_minutes": 30,
      "description": "Live deployment of a full application stack",
      "content": {
        "topics": [
          "Creating Deployment YAML",
          "Configuring Service for access",
          "Adding ConfigMap for configuration",
          "Creating Secret for credentials",
          "Setting up health checks",
          "Scaling the deployment",
          "Viewing logs and metrics"
        ],
        "code_examples": [
          "Deployment manifest",
          "Service manifest",
          "ConfigMap manifest",
          "Secret manifest",
          "kubectl commands"
        ],
        "key_points": [
          "YAML is declarative",
          "Labels and selectors connect resources",
          "Health checks prevent bad deployments",
          "Scaling is simple with Deployments"
        ]
      },
      "facilitator_notes": "Show kubectl commands and explain what's happening. Demonstrate rolling updates."
    },
    {
      "phaseId": "exercise_1",
      "name": "Basic Deployment and Service",
      "type": "exercise",
      "duration_minutes": 20,
      "description": "Create a Deployment and Service for a web app",
      "content": {
        "topics": [
          "Write Deployment YAML",
          "Create Service YAML",
          "Apply manifests",
          "Verify deployment",
          "Access the application"
        ]
      }
    },
    {
      "phaseId": "exercise_2",
      "name": "Configuration Management",
      "type": "exercise",
      "duration_minutes": 25,
      "description": "Use ConfigMaps and Secrets in deployments",
      "content": {
        "topics": [
          "Create ConfigMap",
          "Create Secret",
          "Mount in Deployment",
          "Update deployment",
          "Verify configuration"
        ]
      }
    },
    {
      "phaseId": "challenge",
      "name": "Multi-Tier Application Deployment",
      "type": "challenge",
      "duration_minutes": 30,
      "description": "Deploy a complete application with frontend, backend, and database",
      "content": {
        "topics": [
          "Deploy frontend application",
          "Deploy backend API",
          "Deploy database",
          "Configure Services",
          "Set up ConfigMaps and Secrets",
          "Implement health checks",
          "Scale components"
        ]
      }
    },
    {
      "phaseId": "reflection",
      "name": "Key Takeaways and Production Considerations",
      "type": "reflection",
      "duration_minutes": 15,
      "description": "Consolidate learning and discuss production patterns",
      "content": {
        "topics": [
          "Kubernetes best practices",
          "Resource management",
          "Security considerations",
          "Monitoring and observability",
          "CI/CD integration"
        ],
        "key_points": [
          "Always use Deployments, not Pods directly",
          "Set resource limits",
          "Use Secrets for sensitive data",
          "Implement health checks",
          "Monitor everything"
        ]
      }
    }
  ],
  "exercises": [
    {
      "exerciseId": "ex1_deployment",
      "name": "Basic Deployment and Service",
      "type": "guided",
      "difficulty": "medium",
      "duration_minutes": 20,
      "description": "Create a Deployment and Service for a web application",
      "starter_code": "# deployment.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: web-app\n  # TODO: Add labels\nspec:\n  # TODO: Set replicas\n  selector:\n    matchLabels:\n      # TODO: Add selector labels\n  template:\n    metadata:\n      labels:\n        # TODO: Add pod labels\n    spec:\n      containers:\n      - name: web\n        image: nginx:latest\n        ports:\n        - containerPort: 80\n        # TODO: Add liveness and readiness probes\n\n---\n# service.yaml\napiVersion: v1\nkind: Service\nmetadata:\n  name: web-service\nspec:\n  # TODO: Configure service type and selector\n  ports:\n  - port: 80\n    targetPort: 80",
      "solution_code": "# deployment.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: web-app\n  labels:\n    app: web-app\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: web-app\n  template:\n    metadata:\n      labels:\n        app: web-app\n    spec:\n      containers:\n      - name: web\n        image: nginx:latest\n        ports:\n        - containerPort: 80\n        livenessProbe:\n          httpGet:\n            path: /\n            port: 80\n          initialDelaySeconds: 30\n          periodSeconds: 10\n        readinessProbe:\n          httpGet:\n            path: /\n            port: 80\n          initialDelaySeconds: 5\n          periodSeconds: 5\n        resources:\n          requests:\n            memory: \"64Mi\"\n            cpu: \"250m\"\n          limits:\n            memory: \"128Mi\"\n            cpu: \"500m\"\n\n---\n# service.yaml\napiVersion: v1\nkind: Service\nmetadata:\n  name: web-service\n  labels:\n    app: web-app\nspec:\n  type: ClusterIP\n  selector:\n    app: web-app\n  ports:\n  - port: 80\n    targetPort: 80\n    protocol: TCP",
      "hints": [
        "Labels must match between Deployment selector and Pod template",
        "Service selector must match Pod labels",
        "Health checks prevent serving traffic to unhealthy pods",
        "Set resource limits to prevent resource exhaustion"
      ],
      "verification": "Deployment creates 3 pods, Service routes traffic correctly, health checks work",
      "common_mistakes": [
        "Mismatched labels between selector and pods",
        "Forgetting health checks",
        "Not setting resource limits",
        "Wrong service type"
      ]
    },
    {
      "exerciseId": "ex2_config",
      "name": "Configuration Management",
      "type": "guided",
      "difficulty": "medium",
      "duration_minutes": 25,
      "description": "Create and use ConfigMaps and Secrets",
      "starter_code": "# configmap.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: app-config\n  # TODO: Add data\n\ndata:\n  # TODO: Add configuration key-value pairs\n  # DATABASE_HOST: \"db.example.com\"\n  # LOG_LEVEL: \"info\"\n\n---\n# secret.yaml\napiVersion: v1\nkind: Secret\nmetadata:\n  name: app-secret\ntype: Opaque\n  # TODO: Add secret data (base64 encoded)\n# data:\n#   username: <base64-encoded>\n#   password: <base64-encoded>\n\n---\n# deployment-with-config.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: app-with-config\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: app-with-config\n  template:\n    metadata:\n      labels:\n        app: app-with-config\n    spec:\n      containers:\n      - name: app\n        image: nginx:latest\n        # TODO: Mount ConfigMap as environment variables\n        # TODO: Mount Secret as volume\n        env:\n        # TODO: Reference ConfigMap values\n        volumeMounts:\n        # TODO: Mount Secret volume\n      volumes:\n      # TODO: Define Secret volume",
      "solution_code": "# configmap.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: app-config\ndata:\n  DATABASE_HOST: \"db.example.com\"\n  DATABASE_PORT: \"5432\"\n  LOG_LEVEL: \"info\"\n  APP_NAME: \"my-app\"\n\n---\n# secret.yaml\napiVersion: v1\nkind: Secret\nmetadata:\n  name: app-secret\ntype: Opaque\nstringData:\n  username: admin\n  password: secretpassword123\n\n---\n# deployment-with-config.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: app-with-config\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: app-with-config\n  template:\n    metadata:\n      labels:\n        app: app-with-config\n    spec:\n      containers:\n      - name: app\n        image: nginx:latest\n        env:\n        - name: DATABASE_HOST\n          valueFrom:\n            configMapKeyRef:\n              name: app-config\n              key: DATABASE_HOST\n        - name: DATABASE_PORT\n          valueFrom:\n            configMapKeyRef:\n              name: app-config\n              key: DATABASE_PORT\n        - name: LOG_LEVEL\n          valueFrom:\n            configMapKeyRef:\n              name: app-config\n              key: LOG_LEVEL\n        - name: DB_USERNAME\n          valueFrom:\n            secretKeyRef:\n              name: app-secret\n              key: username\n        - name: DB_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: app-secret\n              key: password\n        volumeMounts:\n        - name: config-volume\n          mountPath: /etc/config\n          readOnly: true\n      volumes:\n      - name: config-volume\n        configMap:\n          name: app-config",
      "verification": "ConfigMap and Secret are created, deployment uses them correctly, environment variables are set",
      "common_mistakes": [
        "Using data instead of stringData for Secrets",
        "Not base64 encoding Secret values when using data",
        "Mismatched ConfigMap/Secret names",
        "Wrong mount paths"
      ]
    }
  ],
  "challenges": [
    {
      "challengeId": "multi_tier",
      "name": "Multi-Tier Application Deployment",
      "description": "Deploy a complete application stack with frontend, backend, and database",
      "requirements": [
        "Deploy frontend application (nginx)",
        "Deploy backend API (FastAPI)",
        "Deploy PostgreSQL database",
        "Configure Services for each tier",
        "Set up ConfigMaps for configuration",
        "Create Secrets for database credentials",
        "Implement health checks for all components",
        "Scale frontend and backend independently"
      ],
      "evaluation_criteria": [
        "All components deploy successfully",
        "Services route traffic correctly",
        "Configuration is externalized",
        "Secrets are used for sensitive data",
        "Health checks work",
        "Scaling works independently",
        "Components can communicate"
      ],
      "stretch_goals": [
        "Add Ingress for external access",
        "Implement HorizontalPodAutoscaler",
        "Add PersistentVolumes for database",
        "Set up monitoring with Prometheus"
      ]
    }
  ],
  "resources": {
    "official_docs": [
      "https://kubernetes.io/docs/home/",
      "https://kubernetes.io/docs/concepts/",
      "https://kubernetes.io/docs/tutorials/"
    ],
    "tutorials": [
      "Kubernetes Basics - Official Tutorial",
      "Kubernetes for Beginners - freeCodeCamp"
    ],
    "videos": [
      "Kubernetes Tutorial for Beginners - YouTube",
      "Kubernetes Deep Dive - CNCF"
    ],
    "community": [
      "Kubernetes Slack",
      "r/kubernetes",
      "Stack Overflow - kubernetes tag"
    ]
  },
  "assessment": {
    "knowledge_check": [
      {
        "question": "What's the difference between a Pod and a Deployment?",
        "type": "short_answer",
        "answer": "A Pod is the smallest deployable unit in Kubernetes, containing one or more containers. A Deployment manages Pods, providing features like rolling updates, scaling, and self-healing. You should always use Deployments, not create Pods directly.",
        "explanation": "Deployments provide essential production features"
      },
      {
        "question": "What are the different Service types and when should you use each?",
        "type": "short_answer",
        "answer": "ClusterIP (default): Internal access only. NodePort: Exposes service on each node's IP. LoadBalancer: Cloud provider load balancer. Use ClusterIP for internal services, NodePort for development, LoadBalancer for production external access.",
        "explanation": "Service type determines how traffic reaches your pods"
      },
      {
        "question": "How do ConfigMaps and Secrets differ?",
        "type": "short_answer",
        "answer": "ConfigMaps store non-sensitive configuration data (plain text). Secrets store sensitive data (base64 encoded, but not encrypted). Use ConfigMaps for config files, environment variables. Use Secrets for passwords, API keys, certificates.",
        "explanation": "Both provide configuration, but Secrets are for sensitive data"
      }
    ],
    "practical_assessment": "Deploy a multi-tier application to Kubernetes with proper configuration management, health checks, and scaling",
    "self_assessment": [
      "Can I create and manage Deployments?",
      "Do I understand how Services work?",
      "Can I use ConfigMaps and Secrets?",
      "Do I know how to scale applications?",
      "Can I troubleshoot deployment issues?"
    ]
  },
  "next_steps": {
    "next_workshop": "L13_docker_containerization",
    "practice_projects": [
      "Deploy a microservices architecture",
      "Set up CI/CD with Kubernetes",
      "Implement monitoring and logging"
    ],
    "deeper_learning": [
      "Advanced Kubernetes patterns",
      "Helm charts and package management",
      "Service mesh (Istio, Linkerd)"
    ]
  },
  "axiom_zero_integration": {
    "love_moments": [
      "Celebrating first successful deployment",
      "Encouraging experimentation with different configurations",
      "Patient troubleshooting of deployment issues"
    ],
    "truth_moments": [
      "Honest discussion of Kubernetes complexity",
      "Clear explanation of resource requirements",
      "Acknowledging when Kubernetes is overkill"
    ],
    "beauty_moments": [
      "Elegant YAML configurations",
      "Beautiful declarative deployments",
      "Clean separation of concerns with ConfigMaps and Secrets"
    ]
  }
}
