{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "id": "reactive-index",
  "name": "Reactive Artifact Indexing",
  "version": "1.0.0",
  "description": "Skill for implementing reactive artifact indexing with cached indices and fast file-based counting",
  "category": "performance",
  "complexity": "intermediate",
  "axiomAlignment": {
    "A0_love_truth_beauty": "Respects developer flow (Wu Wei) by eliminating friction",
    "A1_verifiability": "Cached indices include hashes for integrity verification",
    "A3_transparency": "Clear separation between fast local checks and accurate CI validation"
  },
  "trigger_patterns": [
    "pre-commit hooks are slow",
    "artifact synchronization taking too long",
    "need instant feedback on file changes",
    "documentation counts out of sync"
  ],
  "prerequisites": [
    "Python 3.9+",
    "JSON file read/write access",
    "Git hooks or CI/CD pipeline"
  ],
  "knowledge_references": [
    "reactive-indexing-patterns",
    "ci-cd-patterns",
    "workflow-patterns"
  ],
  "workflow": {
    "steps": [
      {
        "id": "1_assess",
        "name": "Assess Current State",
        "description": "Identify which operations are slow and why",
        "actions": [
          "Profile pre-commit hook execution time",
          "Identify subprocess calls (pytest, etc.)",
          "List artifact types being synchronized"
        ]
      },
      {
        "id": "2_cache_schema",
        "name": "Define Cache Schema",
        "description": "Design the artifact index JSON structure",
        "template": {
          "schema_version": "1.0.0",
          "updated_at": "<ISO 8601 timestamp>",
          "artifacts": {
            "<artifact_type>": {
              "count": "<number>",
              "hash": "<content_hash>",
              "last_modified": "<timestamp>",
              "breakdown": "<optional category breakdown>"
            }
          }
        },
        "location": ".agent/cache/artifact-index.json",        "gitignore": true
      },
      {
        "id": "3_fast_counting",
        "name": "Implement Fast Counting",
        "description": "Replace slow subprocess calls with file-based counting",
        "patterns": {
          "test_functions": {
            "regex": "^\\s*(?:async\\s+)?def\\s+(test_\\w+)",
            "target": "test_*.py files",
            "speedup": "~100x vs pytest --collect-only"
          },
          "file_count": {
            "method": "glob with exclusions",
            "target": "Any file type"
          }
        }
      },
      {
        "id": "4_update_script",
        "name": "Create Index Updater",
        "description": "Script to update index on file changes",
        "features": [
          "Accept file path or --full flag",
          "Detect artifact type from path",
          "Update only affected index section",
          "Debounce rapid changes"
        ]
      },
      {
        "id": "5_trigger_setup",
        "name": "Configure Update Triggers",
        "description": "Set up mechanisms to trigger index updates",
        "options": {
          "vscode_runonsave": {
            "extension": "emeraldwalk.RunOnSave",
            "config_location": ".vscode/settings.json",
            "recommended_for": "VS Code users"
          },
          "python_watchdog": {
            "library": "watchdog",
            "approach": "Background daemon",
            "recommended_for": "CI/automated environments"
          },
          "git_hooks": {
            "trigger": "post-checkout, post-merge",
            "approach": "Rebuild on branch changes"
          }
        }
      },
      {
        "id": "6_precommit_integration",
        "name": "Integrate with Pre-commit",
        "description": "Modify pre-commit to use cached index",
        "behavior": {
          "fresh_cache": "Read counts from cache (instant)",
          "stale_cache": "Run fast file-based update first",
          "missing_cache": "Create new cache with fast counting"
        },
        "staleness_threshold": "1 hour default"
      },
      {
        "id": "7_ci_validation",
        "name": "Add CI Validation Layer",
        "description": "Use CI for authoritative validation",
        "actions": [
          "Run full sync in CI pipeline",
          "Use pytest --collect-only for accurate test count",
          "Auto-commit if counts changed"
        ]
      }
    ]
  },
  "templates": {
    "artifact_index": {
      "description": "Template for artifact-index.json",
      "path": "templates/validation/artifact-index.json.tmpl"
    },
    "update_script": {
      "description": "Template for update_index.py",
      "path": "templates/validation/update_index.py.tmpl"
    },
    "vscode_settings": {
      "description": "VS Code settings for RunOnSave",
      "snippet": {
        "emeraldwalk.runonsave": {
          "commands": [
            {
              "match": "\\\\.agent/(agents|skills)/.*",              "cmd": "python scripts/validation/update_index.py ${file}"
            },
            {
              "match": "tests/.*\\\\.py$",
              "cmd": "python scripts/validation/update_index.py ${file}"
            }
          ]
        }
      }
    }
  },
  "success_metrics": {
    "pre_commit_time": "< 2 seconds",
    "index_update_time": "< 500ms",
    "accuracy": "CI validates, no drift over time"
  },
  "anti_patterns": [
    {
      "name": "Subprocess in hooks",
      "description": "Running slow subprocesses in pre-commit",
      "solution": "Use file-based counting and cached index"
    },
    {
      "name": "Full rebuild always",
      "description": "Rebuilding entire index on any change",
      "solution": "Use affected detection to update only relevant parts"
    },
    {
      "name": "Skip validation",
      "description": "Removing validation due to slowness",
      "solution": "Keep validation but make it fast"
    }
  ],
  "examples": {
    "cursor_agent_factory": {      "description": "Implementation in this repository",
      "files": [
        "scripts/validation/sync_artifacts.py",
        "scripts/validation/update_index.py",
        ".agent/cache/artifact-index.json"      ]
    }
  },
  "related_skills": [
    "ci-cd-patterns",
    "workflow-generation"
  ],
  "generated_by": "Antigravity Agent Factory",  "research_source": "knowledge/reactive-indexing-patterns.json"
}
