{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://cursor-agent-factory.dev/schemas/knowledge-file.schema.json",
    "title": "Knowledge File Schema",
    "description": "Schema for knowledge pattern files in the {directories.knowledge}/ directory",
    "type": "object",
    "required": [
        "$schema",
        "id",
        "title",
        "description",
        "version",
        "category",
        "axiomAlignment",
        "patterns",
        "related_skills",
        "related_knowledge"
    ],
    "additionalProperties": true,
    "properties": {
        "$schema": {
            "const": "http://json-schema.org/draft-07/schema#"
        },
        "id": {
            "type": "string",
            "pattern": "^[a-z0-9-]+$",
            "minLength": 3,
            "description": "Unique identifier matching filename without .json extension"
        },
        "title": {
            "type": "string",
            "minLength": 10,
            "description": "Human-readable title for the knowledge file"
        },
        "description": {
            "type": "string",
            "minLength": 20,
            "description": "Detailed description of what patterns this file contains"
        },
        "version": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+\\.\\d+$",
            "description": "Semantic version (major.minor.patch)"
        },
        "category": {
            "type": "string",
            "enum": [
                "core",
                "rag",
                "agent-patterns",
                "integration",
                "observability",
                "specialized",
                "workflow",
                "optimization",
                "security",
                "testing",
                "ai-ml",
                "trading",
                "sap",
                "dotnet",
                "java",
                "web"
            ],
            "description": "Category for organizing knowledge files"
        },
        "axiomAlignment": {
            "type": "object",
            "required": [
                "A1_verifiability",
                "A2_user_primacy",
                "A3_transparency",
                "A4_non_harm",
                "A5_consistency"
            ],
            "properties": {
                "A1_verifiability": {
                    "type": "string",
                    "minLength": 10
                },
                "A2_user_primacy": {
                    "type": "string",
                    "minLength": 10
                },
                "A3_transparency": {
                    "type": "string",
                    "minLength": 10
                },
                "A4_non_harm": {
                    "type": "string",
                    "minLength": 10
                },
                "A5_consistency": {
                    "type": "string",
                    "minLength": 10
                }
            },
            "description": "How patterns align with the 5-layer axiom architecture"
        },
        "patterns": {
            "type": "object",
            "minProperties": 1,
            "additionalProperties": {
                "type": "object",
                "required": [
                    "description",
                    "use_when",
                    "code_example",
                    "best_practices"
                ],
                "additionalProperties": true,
                "properties": {
                    "description": {
                        "type": "string",
                        "minLength": 20
                    },
                    "use_when": {
                        "type": "string",
                        "minLength": 10
                    },
                    "code_example": {
                        "type": "string",
                        "minLength": 20
                    },
                    "best_practices": {
                        "type": "array",
                        "items": {
                            "type": "string",
                            "minLength": 10
                        },
                        "minItems": 2
                    },
                    "anti_patterns": {
                        "type": "array",
                        "items": {
                            "oneOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "object",
                                    "required": [
                                        "name",
                                        "problem",
                                        "fix"
                                    ],
                                    "properties": {
                                        "name": {
                                            "type": "string"
                                        },
                                        "problem": {
                                            "type": "string"
                                        },
                                        "fix": {
                                            "type": "string"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "related_patterns": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            },
            "description": "Pattern definitions with examples and best practices"
        },
        "anti_patterns": {
            "type": "array",
            "items": {
                "oneOf": [
                    {
                        "type": "string"
                    },
                    {
                        "type": "object",
                        "required": [
                            "name",
                            "problem",
                            "fix"
                        ],
                        "properties": {
                            "name": {
                                "type": "string"
                            },
                            "problem": {
                                "type": "string"
                            },
                            "fix": {
                                "type": "string"
                            }
                        }
                    }
                ]
            }
        },
        "related_skills": {
            "type": "array",
            "items": {
                "type": "string",
                "pattern": "^[a-z0-9-]+$"
            },
            "minItems": 1,
            "description": "Skills that use this knowledge file"
        },
        "related_knowledge": {
            "type": "array",
            "items": {
                "type": "string",
                "pattern": "^[a-z0-9-]+\\.json$"
            },
            "minItems": 1,
            "description": "Related knowledge files"
        }
    }
}
