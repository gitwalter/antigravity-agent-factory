{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "id": "b2b-patterns",
  "name": "B2B Patterns",
  "title": "B2B Integration Patterns",
  "description": "EDI, AS2, partner management, and B2B integration patterns for SAP CPI",
  "version": "1.0.0",
  "category": "sap",
  "axiomAlignment": {
    "A1_verifiability": "EDI standards and acknowledgment handling enable verifiable message exchange",
    "A2_user_primacy": "Partner agreements and TPA documentation preserve trading partner intent",
    "A3_transparency": "Explicit message types and protocols make B2B flows traceable",
    "A4_non_harm": "Signing, encryption, and MDN ensure secure, non-repudiable exchanges",
    "A5_consistency": "Standard EDI/AS2 patterns ensure consistent integration across partners"
  },
  "related_skills": [
    "b2b-integration",
    "cpi-integration-flow",
    "cpi-groovy-scripting"
  ],
  "related_knowledge": [
    "cpi-error-handling.json",
    "mapping-patterns.json",
    "iflow-patterns.json"
  ],
  "metadata": {
    "name": "B2B Integration Patterns",
    "description": "EDI, AS2, partner management, and B2B integration patterns for SAP CPI",
    "version": "1.0.0",
    "lastUpdated": "2026-01-30"
  },
  "ediStandards": {
    "edifact": {
      "description": "UN/EDIFACT - International EDI standard",
      "structure": [
        "UNB (Interchange Header)",
        "UNH (Message Header)",
        "Segments",
        "UNT (Message Trailer)",
        "UNZ (Interchange Trailer)"
      ],
      "commonMessages": [
        {
          "type": "ORDERS",
          "description": "Purchase order"
        },
        {
          "type": "ORDRSP",
          "description": "Order response"
        },
        {
          "type": "DESADV",
          "description": "Despatch advice"
        },
        {
          "type": "INVOIC",
          "description": "Invoice"
        },
        {
          "type": "PRICAT",
          "description": "Price/sales catalogue"
        },
        {
          "type": "INVRPT",
          "description": "Inventory report"
        }
      ],
      "versions": [
        "D96A",
        "D01B",
        "D16A"
      ]
    },
    "x12": {
      "description": "ANSI ASC X12 - North American EDI standard",
      "structure": [
        "ISA (Interchange Header)",
        "GS (Functional Group Header)",
        "ST (Transaction Set Header)",
        "Segments",
        "SE (Transaction Set Trailer)",
        "GE (Functional Group Trailer)",
        "IEA (Interchange Trailer)"
      ],
      "commonMessages": [
        {
          "type": "850",
          "description": "Purchase order"
        },
        {
          "type": "855",
          "description": "Purchase order acknowledgment"
        },
        {
          "type": "856",
          "description": "Ship notice/manifest"
        },
        {
          "type": "810",
          "description": "Invoice"
        },
        {
          "type": "997",
          "description": "Functional acknowledgment"
        },
        {
          "type": "824",
          "description": "Application advice"
        }
      ],
      "versions": [
        "4010",
        "5010",
        "7030"
      ]
    }
  },
  "as2Protocol": {
    "description": "Applicability Statement 2 - Secure HTTP-based EDI transport",
    "features": [
      "Encryption (S/MIME)",
      "Digital signatures",
      "MDN (Message Disposition Notification)",
      "Non-repudiation"
    ],
    "configuration": {
      "sender": [
        "AS2 ID",
        "Signing certificate",
        "Encryption certificate"
      ],
      "receiver": [
        "Partner AS2 ID",
        "Partner certificate",
        "MDN settings"
      ]
    },
    "mdnTypes": {
      "synchronous": "MDN returned in HTTP response",
      "asynchronous": "MDN returned via separate HTTP request"
    },
    "security": {
      "signing": "SHA-256 or SHA-384",
      "encryption": "AES-256 or 3DES"
    }
  },
  "partnerManagement": {
    "partnerProfile": {
      "description": "Configuration for trading partner",
      "attributes": [
        {
          "name": "partnerId",
          "description": "Unique partner identifier"
        },
        {
          "name": "partnerName",
          "description": "Partner display name"
        },
        {
          "name": "ediQualifier",
          "description": "EDI ID qualifier (ZZ, 01, 14)"
        },
        {
          "name": "ediId",
          "description": "EDI partner ID"
        },
        {
          "name": "as2Id",
          "description": "AS2 identifier"
        },
        {
          "name": "certificates",
          "description": "Signing/encryption certificates"
        },
        {
          "name": "endpoints",
          "description": "Partner endpoints"
        },
        {
          "name": "messageTypes",
          "description": "Supported message types"
        }
      ]
    },
    "partnerAgreement": {
      "description": "Bilateral agreement between partners",
      "elements": [
        "Message types",
        "Transport protocol",
        "Security requirements",
        "SLA",
        "Error handling"
      ]
    },
    "partnerDirectory": {
      "description": "CPI Partner Directory for centralized partner data",
      "entities": [
        "StringParameter",
        "BinaryParameter",
        "AlternativePartner",
        "AuthorizedUser"
      ]
    }
  },
  "idocIntegration": {
    "description": "SAP IDoc for B2B with SAP systems",
    "components": {
      "idocType": "Structure definition (e.g., ORDERS05)",
      "messageType": "Logical message (e.g., ORDERS)",
      "partnerProfile": "WE20 configuration",
      "portDefinition": "WE21 port configuration"
    },
    "direction": {
      "outbound": "SAP to Partner (via ALE/RFC)",
      "inbound": "Partner to SAP (via RFC/file)"
    },
    "processingModes": [
      "Immediate",
      "Collect",
      "Scheduled"
    ]
  },
  "acknowledgments": {
    "functionalAck": {
      "description": "Confirms receipt and syntactic validity",
      "edifact": "CONTRL",
      "x12": "997/999"
    },
    "applicationAck": {
      "description": "Confirms business processing",
      "edifact": "APERAK",
      "x12": "824"
    },
    "mdnAck": {
      "description": "AS2 Message Disposition Notification",
      "types": [
        "processed",
        "failed",
        "warning"
      ]
    }
  },
  "errorHandling": {
    "syntaxErrors": {
      "description": "EDI parsing/validation failures",
      "response": "Generate negative acknowledgment"
    },
    "businessErrors": {
      "description": "Business rule violations",
      "response": "Generate application acknowledgment with error details"
    },
    "transportErrors": {
      "description": "Communication failures",
      "response": "Retry with backoff, alert on failure"
    }
  },
  "mappingPatterns": {
    "ediToIdoc": {
      "description": "Map EDI message to SAP IDoc",
      "steps": [
        "Parse EDI",
        "Map to IDoc structure",
        "Set control record",
        "Post to SAP"
      ]
    },
    "idocToEdi": {
      "description": "Map SAP IDoc to EDI message",
      "steps": [
        "Receive IDoc",
        "Map to EDI structure",
        "Generate EDI envelope",
        "Send to partner"
      ]
    },
    "integrationAdvisor": {
      "description": "SAP Integration Advisor for B2B mapping",
      "features": [
        "AI-assisted mapping",
        "Message implementation guidelines (MIG)",
        "Mapping templates"
      ]
    }
  },
  "best_practices": [
    "Use Partner Directory for centralized partner configuration to avoid duplication and ensure consistency",
    "Implement proper acknowledgment handling - always send functional ACK (CONTRL/997) and application ACK (APERAK/824) when required",
    "Store original messages for audit/compliance - retain EDI messages for regulatory requirements",
    "Use correlation IDs for end-to-end tracking across all B2B message exchanges",
    "Implement retry logic with exponential backoff for transient failures in AS2 transport",
    "Monitor message volumes and error rates - set up alerts for abnormal patterns",
    "Test with partner in sandbox environment before production deployment",
    "Document partner agreements and message specs - maintain trading partner agreements (TPA) documentation",
    "Use Integration Advisor for complex mappings - leverage MIG templates for standard message types",
    "Implement proper security (signing, encryption) - use SHA-256 signing and AES-256 encryption for AS2",
    "Validate EDI syntax before processing - catch errors early to avoid downstream issues",
    "Handle MDN (Message Disposition Notification) properly - verify synchronous/asynchronous MDN receipt"
  ],
  "patterns": {
    "as2Integration": {
      "description": "AS2 integration pattern with MDN handling",
      "steps": [
        "Configure AS2 sender/receiver adapters with certificates",
        "Set up MDN handling (synchronous or asynchronous)",
        "Implement retry logic for MDN failures",
        "Store original message and MDN for audit"
      ],
      "use_when": "When implementing as2Integration or when AS2 integration pattern with MDN handling",
      "code_example": "Steps: Configure AS2 sender/receiver adapters with certificates; Set up MDN handling (synchronous or asynchronous); Implement retry logic for MDN failures; Store original message and MDN for audit",
      "best_practices": [
        "Use Partner Directory for centralized partner configuration to avoid duplication and ensure consistency",
        "Implement proper acknowledgment handling - always send functional ACK (CONTRL/997) and application ACK (APERAK/824) when required",
        "Store original messages for audit/compliance - retain EDI messages for regulatory requirements",
        "Use correlation IDs for end-to-end tracking across all B2B message exchanges"
      ]
    },
    "ediToIdocMapping": {
      "description": "EDI to IDoc mapping pattern",
      "steps": [
        "Parse EDI message (EDIFACT or X12)",
        "Map EDI segments to IDoc segments",
        "Set IDoc control record (EDI_DC40)",
        "Post IDoc to SAP system",
        "Handle acknowledgment and error responses"
      ],
      "use_when": "When implementing ediToIdocMapping or when EDI to IDoc mapping pattern",
      "code_example": "Steps: Parse EDI message (EDIFACT or X12); Map EDI segments to IDoc segments; Set IDoc control record (EDI_DC40); Post IDoc to SAP system; Handle acknowledgment and error responses",
      "best_practices": [
        "Use Partner Directory for centralized partner configuration to avoid duplication and ensure consistency",
        "Implement proper acknowledgment handling - always send functional ACK (CONTRL/997) and application ACK (APERAK/824) when required",
        "Store original messages for audit/compliance - retain EDI messages for regulatory requirements",
        "Use correlation IDs for end-to-end tracking across all B2B message exchanges"
      ]
    },
    "partnerOnboarding": {
      "description": "Trading partner onboarding workflow",
      "steps": [
        "Create partner profile in Partner Directory",
        "Exchange certificates and AS2 IDs",
        "Configure message types and versions",
        "Test in sandbox environment",
        "Document partner agreement",
        "Deploy to production with monitoring"
      ],
      "use_when": "When implementing partnerOnboarding or when Trading partner onboarding workflow",
      "code_example": "Steps: Create partner profile in Partner Directory; Exchange certificates and AS2 IDs; Configure message types and versions; Test in sandbox environment; Document partner agreement",
      "best_practices": [
        "Use Partner Directory for centralized partner configuration to avoid duplication and ensure consistency",
        "Implement proper acknowledgment handling - always send functional ACK (CONTRL/997) and application ACK (APERAK/824) when required",
        "Store original messages for audit/compliance - retain EDI messages for regulatory requirements",
        "Use correlation IDs for end-to-end tracking across all B2B message exchanges"
      ]
    },
    "acknowledgmentFlow": {
      "description": "Acknowledgment handling pattern",
      "steps": [
        "Receive EDI message",
        "Validate syntax and generate functional ACK",
        "Process business logic",
        "Generate application ACK with results",
        "Store all messages for audit trail"
      ],
      "use_when": "When implementing acknowledgmentFlow or when Acknowledgment handling pattern",
      "code_example": "Steps: Receive EDI message; Validate syntax and generate functional ACK; Process business logic; Generate application ACK with results; Store all messages for audit trail",
      "best_practices": [
        "Use Partner Directory for centralized partner configuration to avoid duplication and ensure consistency",
        "Implement proper acknowledgment handling - always send functional ACK (CONTRL/997) and application ACK (APERAK/824) when required",
        "Store original messages for audit/compliance - retain EDI messages for regulatory requirements",
        "Use correlation IDs for end-to-end tracking across all B2B message exchanges"
      ]
    }
  },
  "anti_patterns": [
    {
      "name": "Hardcoding partner configuration",
      "problem": "Hardcoding partner IDs, certificates, or endpoints makes partner management difficult and error-prone",
      "fix": "Use Partner Directory for all partner-specific configuration, reference via partner ID"
    },
    {
      "name": "Ignoring acknowledgments",
      "problem": "Not handling functional or application acknowledgments leads to partner confusion and compliance issues",
      "fix": "Always implement proper ACK handling - send CONTRL/997 for syntax validation and APERAK/824 for business processing"
    },
    {
      "name": "Not storing original messages",
      "problem": "Losing original EDI messages makes audit trails impossible and compliance verification difficult",
      "fix": "Store all incoming and outgoing messages with timestamps and correlation IDs in persistent storage"
    },
    {
      "name": "Weak security configuration",
      "problem": "Using weak encryption or not signing messages exposes sensitive business data and lacks non-repudiation",
      "fix": "Use SHA-256 for signing, AES-256 for encryption, and always require MDN for AS2 messages"
    },
    {
      "name": "No idempotency handling",
      "problem": "Processing duplicate messages causes data inconsistencies and business errors",
      "fix": "Implement idempotency checks using message IDs or control numbers, reject duplicates"
    }
  ]
}
