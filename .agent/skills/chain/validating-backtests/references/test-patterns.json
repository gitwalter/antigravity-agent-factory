{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "id": "test-patterns",
  "name": "Test Patterns",
  "title": "Test Patterns",
  "description": "Testing patterns for unit, integration, e2e, property-based, snapshot, and mutation testing",
  "version": "1.0.0",
  "last_updated": "2026-02-10",
  "category": "testing",
  "axiomAlignment": {
    "A1_verifiability": "Executable tests provide verifiable specifications of behavior",
    "A2_user_primacy": "Tests encode user requirements and acceptance criteria",
    "A3_transparency": "Test cases make expected behavior explicit and documented",
    "A4_non_harm": "Tests prevent regressions and protect against unintended changes",
    "A5_consistency": "Test patterns ensure consistent quality across the codebase"
  },
  "related_skills": [
    "agent-testing",
    "bdd",
    "test-translation",
    "frontend-testing"
  ],
  "related_knowledge": [
    "tdd-patterns.json",
    "bdd-patterns.json",
    "testcontainers-patterns.json"
  ],
  "patterns": {
    "unit_testing": {
      "description": "Test individual units (functions, methods, classes) in isolation with mocked dependencies",
      "when_to_use": "Business logic, pure functions, validation, transformations",
      "example_structure": "Arrange-Act-Assert (AAA) pattern; one assertion per test; descriptive test names",
      "best_practices": [
        "Mock external dependencies",
        "Test single responsibility",
        "Use parameterized tests for edge cases",
        "Keep tests fast (<100ms)"
      ],
      "use_when": "Business logic, pure functions, validation, transformations",
      "code_example": "def test_pattern():\n    from unittest.mock import Mock\n    mock_dep = Mock(return_value='expected')\n    result = function_under_test(mock_dep)\n    assert result == 'expected'"
    },
    "integration_testing": {
      "description": "Test interactions between components (API + DB, services + repositories)",
      "when_to_use": "API endpoints, database operations, service integrations, message queues",
      "example_structure": "End-to-end flow per test; real or Testcontainers for databases; contract tests for external APIs",
      "best_practices": [
        "Use Testcontainers for real DB",
        "Test complete user flows",
        "Clean up test data",
        "Isolate tests with transactions"
      ],
      "use_when": "API endpoints, database operations, service integrations, message queues",
      "code_example": "def test_pattern():\n    from unittest.mock import Mock\n    mock_dep = Mock(return_value='expected')\n    result = function_under_test(mock_dep)\n    assert result == 'expected'"
    },
    "e2e_testing": {
      "description": "Test entire application from user perspective using browser automation",
      "when_to_use": "Critical user journeys, checkout flows, authentication, cross-browser compatibility",
      "example_structure": "Playwright/Cypress; page object model; data-testid selectors; parallel execution",
      "best_practices": [
        "Minimize test count (expensive)",
        "Use stable selectors",
        "Run in CI with retries",
        "Screenshot on failure"
      ],
      "use_when": "Critical user journeys, checkout flows, authentication, cross-browser compatibility",
      "code_example": "def test_pattern():\n    from unittest.mock import Mock\n    mock_dep = Mock(return_value='expected')\n    result = function_under_test(mock_dep)\n    assert result == 'expected'"
    },
    "property_based_testing": {
      "description": "Generate many random inputs and verify invariants hold for all",
      "when_to_use": "Serialization/deserialization, mathematical properties, state machines, parsers",
      "example_structure": "Hypothesis (Python) / fast-check (JS) / jqwik (Java); @given decorator; strategies for input generation",
      "best_practices": [
        "Define clear invariants",
        "Use assume() to filter invalid inputs",
        "Shrink failing examples",
        "Combine with example-based tests"
      ],
      "use_when": "Serialization/deserialization, mathematical properties, state machines, parsers",
      "code_example": "def test_pattern():\n    from unittest.mock import Mock\n    mock_dep = Mock(return_value='expected')\n    result = function_under_test(mock_dep)\n    assert result == 'expected'"
    },
    "snapshot_testing": {
      "description": "Capture output and compare against stored snapshot for regression detection",
      "when_to_use": "UI components, JSON/XML output, serialization, error messages",
      "example_structure": "Jest/Vitest snapshot; store in __snapshots__; review diffs on change",
      "best_practices": [
        "Use for stable outputs only",
        "Review snapshot updates",
        "Avoid large snapshots",
        "Use inline snapshots for small data"
      ],
      "use_when": "UI components, JSON/XML output, serialization, error messages",
      "code_example": "def test_pattern():\n    from unittest.mock import Mock\n    mock_dep = Mock(return_value='expected')\n    result = function_under_test(mock_dep)\n    assert result == 'expected'"
    },
    "mutation_testing": {
      "description": "Introduce faults (mutations) and verify tests catch them; measures test quality",
      "when_to_use": "Validating test suite effectiveness, finding weak tests, coverage gaps",
      "example_structure": "mutmut (Python) / Stryker (JS) / PIT (Java); mutate operators (arithmetic, logical, boundary)",
      "best_practices": [
        "Focus on critical paths",
        "Aim for 80%+ mutation score",
        "Fix tests that miss mutations",
        "Run periodically not every CI"
      ],
      "use_when": "Validating test suite effectiveness, finding weak tests, coverage gaps",
      "code_example": "def test_pattern():\n    from unittest.mock import Mock\n    mock_dep = Mock(return_value='expected')\n    result = function_under_test(mock_dep)\n    assert result == 'expected'"
    },
    "contract_testing": {
      "description": "Verify API contracts between consumer and provider; Pact or similar",
      "when_to_use": "Microservices, API versioning, provider/consumer teams",
      "example_structure": "Consumer defines expectations; provider verification; shared contract files",
      "best_practices": [
        "Test shape not implementation",
        "Version contracts",
        "Run provider verification in provider CI"
      ],
      "use_when": "Microservices, API versioning, provider/consumer teams",
      "code_example": "def test_pattern():\n    from unittest.mock import Mock\n    mock_dep = Mock(return_value='expected')\n    result = function_under_test(mock_dep)\n    assert result == 'expected'"
    },
    "test_doubles": {
      "description": "Mocks, stubs, fakes, spies\u2014replace real dependencies with controllable substitutes",
      "when_to_use": "External APIs, databases, file systems, time, random",
      "example_structure": "Mock: verify interactions; Stub: return canned responses; Fake: working implementation",
      "best_practices": [
        "Prefer fakes over mocks when possible",
        "Don't over-mock",
        "Verify behavior not implementation"
      ],
      "use_when": "External APIs, databases, file systems, time, random",
      "code_example": "def test_pattern():\n    from unittest.mock import Mock\n    mock_dep = Mock(return_value='expected')\n    result = function_under_test(mock_dep)\n    assert result == 'expected'"
    }
  },
  "best_practices": [
    "Mock external dependencies",
    "Test single responsibility",
    "Use parameterized tests for edge cases",
    "Keep tests fast (<100ms)",
    "Use Testcontainers for real DB",
    "Test complete user flows",
    "Clean up test data",
    "Isolate tests with transactions"
  ],
  "anti_patterns": [
    "Applying patterns without understanding the underlying concepts",
    "Copy-pasting solutions without adapting to specific context",
    "Over-engineering simple problems with complex patterns"
  ]
}
