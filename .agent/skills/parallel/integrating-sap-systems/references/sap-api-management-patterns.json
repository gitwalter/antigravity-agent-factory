{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "id": "sap-api-management-patterns",
  "name": "SAP API Management Patterns",
  "title": "SAP API Management Patterns",
  "version": "1.0.0",
  "description": "API Management patterns including policies, proxies, products, developer portal, and analytics",
  "category": "sap",
  "last_updated": "2026-02-09",
  "axiomAlignment": {
    "A1_verifiability": "Request validation and analytics enable verifiable API behavior",
    "A2_user_primacy": "OAuth, quotas, and developer portal serve API consumer needs",
    "A3_transparency": "API documentation and lifecycle stages make governance explicit",
    "A4_non_harm": "Rate limiting, spike arrest, and error handling prevent harmful usage",
    "A5_consistency": "Unified patterns for proxies, products, policies, and monitoring"
  },
  "related_skills": [
    "integrating-sap-systems",
    "designing-apis",
    "securing-sap-systems",
    "btp-deployment",
    "error-handling"
  ],
  "related_knowledge": [
    "sap-security-patterns.json",
    "sap-btp-patterns.json",
    "iflow-patterns.json",
    "sap-event-mesh.json"
  ],
  "patterns": {
    "apimgmt-spike-arrest": {
      "id": "apimgmt-spike-arrest",
      "name": "Spike Arrest Policy",
      "description": "Protect backend from traffic spikes",
      "scenario": "All APIs",
      "code": {
        "policy": "<SpikeArrest async=\"false\" continueOnError=\"false\" enabled=\"true\" name=\"SpikeArrest-1\">\n  <Properties>\n    <Property name=\"spikeArrest\">100ps</Property>\n  </Properties>\n</SpikeArrest>"
      },
      "use_when": "When implementing Spike Arrest Policy or when Protect backend from traffic spikes",
      "code_example": "<SpikeArrest async=\"false\" continueOnError=\"false\" enabled=\"true\" name=\"SpikeArrest-1\">\n  <Properties>\n    <Property name=\"spikeArrest\">100ps</Property>\n  </Properties>\n</SpikeArrest>",
      "best_practices": [
        "Use spike arrest for all APIs",
        "Set appropriate rate (e.g., 100ps = 100 per second)",
        "Protect backend systems",
        "Monitor spike arrest violations"
      ]
    },
    "apimgmt-quota": {
      "id": "apimgmt-quota",
      "name": "Quota Policy",
      "description": "Limit API usage per time period",
      "scenario": "API monetization, usage limits",
      "code": {
        "policy": "<Quota async=\"false\" continueOnError=\"false\" enabled=\"true\" name=\"Quota-1\" type=\"calendar\">\n  <Properties>\n    <Property name=\"interval\">1</Property>\n    <Property name=\"timeUnit\">day</Property>\n    <Property name=\"allow\">10000</Property>\n  </Properties>\n</Quota>"
      },
      "use_when": "When API monetization, usage limits",
      "code_example": "<Quota async=\"false\" continueOnError=\"false\" enabled=\"true\" name=\"Quota-1\" type=\"calendar\">\n  <Properties>\n    <Property name=\"interval\">1</Property>\n    <Property name=\"timeUnit\">day</Property>\n    <Property name=\"allow\">10000</Property>\n  </Properties>\n</Quota>",
      "best_practices": [
        "Set quotas based on business needs",
        "Use calendar or rolling window",
        "Configure proper intervals",
        "Monitor quota usage"
      ]
    },
    "apimgmt-oauth": {
      "id": "apimgmt-oauth",
      "name": "OAuth 2.0 Policy",
      "description": "OAuth authentication for APIs",
      "scenario": "All protected APIs",
      "code": {
        "policy": "<OAuthV2 async=\"false\" continueOnError=\"false\" enabled=\"true\" name=\"OAuthV2-1\">\n  <Properties>\n    <Property name=\"operation\">VerifyAccessToken</Property>\n    <Property name=\"publicKey\">public_key</Property>\n  </Properties>\n</OAuthV2>"
      },
      "use_when": "When All protected APIs",
      "code_example": "<OAuthV2 async=\"false\" continueOnError=\"false\" enabled=\"true\" name=\"OAuthV2-1\">\n  <Properties>\n    <Property name=\"operation\">VerifyAccessToken</Property>\n    <Property name=\"publicKey\">public_key</Property>\n  </Properties>\n</OAuthV2>",
      "best_practices": [
        "Use OAuth 2.0 for authentication",
        "Verify access tokens",
        "Configure public key properly",
        "Handle token expiration"
      ]
    },
    "apimgmt-caching": {
      "id": "apimgmt-caching",
      "name": "Caching Policy",
      "description": "Cache API responses This pattern supports SAP Caching Policy integration and implementation.",
      "scenario": "Read-heavy APIs",
      "code": {
        "policy": "<ResponseCache async=\"false\" continueOnError=\"false\" enabled=\"true\" name=\"ResponseCache-1\">\n  <Properties>\n    <Property name=\"cacheKey\">\n      <KeyFragment ref=\"request.uri\" />\n      <KeyFragment ref=\"request.queryparam.id\" />\n    </Property>\n    <Property name=\"timeToLiveInSeconds\">300</Property>\n  </Properties>\n</ResponseCache>"
      },
      "use_when": "When Read-heavy APIs",
      "code_example": "<ResponseCache async=\"false\" continueOnError=\"false\" enabled=\"true\" name=\"ResponseCache-1\">\n  <Properties>\n    <Property name=\"cacheKey\">\n      <KeyFragment ref=\"request.uri\" />\n      <KeyFragment ref=\"request.queryparam.id\" />\n    </Property>\n    <Property name=\"timeToLiveInSeconds\">300</Property>\n  </Properties>\n</ResponseCache>",
      "best_practices": [
        "Cache GET requests",
        "Set appropriate TTL",
        "Use proper cache keys",
        "Invalidate cache on updates"
      ]
    },
    "apimgmt-api-proxy": {
      "id": "apimgmt-api-proxy",
      "name": "API Proxy Pattern",
      "description": "Create API proxy This pattern supports SAP API Proxy Pattern integration and implementation.",
      "scenario": "All APIs",
      "code": {
        "proxy": "Create API Proxy:\n- Base path: /api/v1\n- Target endpoint: https://backend.example.com\n- Policies: OAuth, Quota, Spike Arrest"
      },
      "use_when": "When implementing API Proxy Pattern or when Create API proxy This pattern supports SAP API Proxy Pattern integration and imp",
      "code_example": "Create API Proxy:\n- Base path: /api/v1\n- Target endpoint: https://backend.example.com\n- Policies: OAuth, Quota, Spike Arrest",
      "best_practices": [
        "Use proxies for all APIs",
        "Set proper base paths",
        "Configure target endpoints",
        "Apply security policies"
      ]
    },
    "apimgmt-api-product": {
      "id": "apimgmt-api-product",
      "name": "API Product Pattern",
      "description": "Package APIs into products",
      "scenario": "API monetization",
      "code": {
        "product": "Create API Product:\n- Name: Travel Booking API\n- APIs: TravelBooking, TravelBookingItem\n- Quota: 10,000/day\n- Scopes: Display, Edit"
      },
      "use_when": "When API monetization",
      "code_example": "Create API Product:\n- Name: Travel Booking API\n- APIs: TravelBooking, TravelBookingItem\n- Quota: 10,000/day\n- Scopes: Display, Edit",
      "best_practices": [
        "Group related APIs",
        "Set quotas per product",
        "Configure scopes",
        "Publish to developer portal"
      ]
    },
    "apimgmt-developer-portal": {
      "id": "apimgmt-developer-portal",
      "name": "Developer Portal Pattern",
      "description": "Publish APIs to developer portal",
      "scenario": "External API consumption",
      "code": {
        "portal": "Publish to Developer Portal:\n- API documentation\n- Try-it-out functionality\n- Code samples\n- Authentication guide"
      },
      "use_when": "When External API consumption",
      "code_example": "Publish to Developer Portal:\n- API documentation\n- Try-it-out functionality\n- Code samples\n- Authentication guide",
      "best_practices": [
        "Provide complete documentation",
        "Include code samples",
        "Enable try-it-out",
        "Document authentication"
      ]
    },
    "apimgmt-request-transformation": {
      "id": "apimgmt-request-transformation",
      "name": "Request Transformation Policy",
      "description": "Transform request before backend",
      "scenario": "API versioning, format conversion",
      "code": {
        "policy": "<AssignMessage async=\"false\" name=\"TransformRequest\">\n  <AssignTo createNew=\"false\" type=\"request\"/>\n  <Set>\n    <Payload contentType=\"application/json\">\n      {\"transformed\": \"data\"}\n    </Payload>\n  </Set>\n</AssignMessage>"
      },
      "use_when": "When API versioning, format conversion",
      "code_example": "<AssignMessage async=\"false\" name=\"TransformRequest\">\n  <AssignTo createNew=\"false\" type=\"request\"/>\n  <Set>\n    <Payload contentType=\"application/json\">\n      {\"transformed\": \"data\"}\n    </Payload>\n  </Set>\n</AssignMessage>",
      "best_practices": [
        "Transform requests when needed",
        "Maintain request structure",
        "Handle errors gracefully",
        "Test transformations"
      ]
    },
    "apimgmt-response-transformation": {
      "id": "apimgmt-response-transformation",
      "name": "Response Transformation Policy",
      "description": "Transform response from backend",
      "scenario": "API versioning, format conversion",
      "code": {
        "policy": "<AssignMessage async=\"false\" name=\"TransformResponse\">\n  <AssignTo createNew=\"false\" type=\"response\"/>\n  <Set>\n    <Payload contentType=\"application/json\">\n      {\"transformed\": \"response\"}\n    </Payload>\n  </Set>\n</AssignMessage>"
      },
      "use_when": "When API versioning, format conversion",
      "code_example": "<AssignMessage async=\"false\" name=\"TransformResponse\">\n  <AssignTo createNew=\"false\" type=\"response\"/>\n  <Set>\n    <Payload contentType=\"application/json\">\n      {\"transformed\": \"response\"}\n    </Payload>\n  </Set>\n</AssignMessage>",
      "best_practices": [
        "Transform responses when needed",
        "Maintain response structure",
        "Handle errors gracefully",
        "Test transformations"
      ]
    },
    "apimgmt-error-handling": {
      "id": "apimgmt-error-handling",
      "name": "Error Handling Policy",
      "description": "Handle API errors This pattern supports SAP Error Handling Policy integration and implementation.",
      "scenario": "All APIs",
      "code": {
        "policy": "<RaiseFault async=\"false\" name=\"HandleError\">\n  <FaultResponse>\n    <Set>\n      <StatusCode>500</StatusCode>\n      <ReasonPhrase>Internal Server Error</ReasonPhrase>\n    </Set>\n    <Payload contentType=\"application/json\">\n      {\"error\": \"message\"}\n    </Payload>\n  </FaultResponse>\n</RaiseFault>"
      },
      "use_when": "When implementing Error Handling Policy or when Handle API errors This pattern supports SAP Error Handling Policy integration an",
      "code_example": "<RaiseFault async=\"false\" name=\"HandleError\">\n  <FaultResponse>\n    <Set>\n      <StatusCode>500</StatusCode>\n      <ReasonPhrase>Internal Server Error</ReasonPhrase>\n    </Set>\n    <Payload contentType=\"application/json\">\n      {\"error\": \"message\"}\n    </Payload>\n  </FaultResponse>\n</RaiseFault>",
      "best_practices": [
        "Handle errors gracefully",
        "Return proper status codes",
        "Provide error messages",
        "Log errors"
      ]
    },
    "apimgmt-cors": {
      "id": "apimgmt-cors",
      "name": "CORS Policy",
      "description": "Configure CORS This pattern supports SAP CORS Policy integration and implementation.",
      "scenario": "Web applications",
      "code": {
        "policy": "<CORS async=\"false\" continueOnError=\"false\" enabled=\"true\" name=\"CORS-1\">\n  <Properties>\n    <Property name=\"allowedOrigins\">https://example.com</Property>\n    <Property name=\"allowedMethods\">GET,POST,PUT,DELETE</Property>\n    <Property name=\"allowedHeaders\">Content-Type,Authorization</Property>\n  </Properties>\n</CORS>"
      },
      "use_when": "When Web applications",
      "code_example": "<CORS async=\"false\" continueOnError=\"false\" enabled=\"true\" name=\"CORS-1\">\n  <Properties>\n    <Property name=\"allowedOrigins\">https://example.com</Property>\n    <Property name=\"allowedMethods\">GET,POST,PUT,DELETE</Property>\n    <Property name=\"allowedHeaders\">Content-Type,Authorization</Property>\n  </Properties>\n</CORS>",
      "best_practices": [
        "Configure CORS properly",
        "Whitelist allowed origins",
        "Set allowed methods",
        "Test CORS configuration"
      ]
    },
    "apimgmt-rate-limiting": {
      "id": "apimgmt-rate-limiting",
      "name": "Rate Limiting Policy",
      "description": "Limit request rate This pattern supports SAP Rate Limiting Policy integration and implementation.",
      "scenario": "API protection",
      "code": {
        "policy": "<Quota async=\"false\" name=\"RateLimit\">\n  <Properties>\n    <Property name=\"interval\">1</Property>\n    <Property name=\"timeUnit\">minute</Property>\n    <Property name=\"allow\">100</Property>\n  </Properties>\n</Quota>"
      },
      "use_when": "When API protection",
      "code_example": "<Quota async=\"false\" name=\"RateLimit\">\n  <Properties>\n    <Property name=\"interval\">1</Property>\n    <Property name=\"timeUnit\">minute</Property>\n    <Property name=\"allow\">100</Property>\n  </Properties>\n</Quota>",
      "best_practices": [
        "Set appropriate rate limits",
        "Use per-minute or per-second",
        "Monitor rate limit usage",
        "Return 429 for rate limit exceeded"
      ]
    },
    "apimgmt-api-versioning": {
      "id": "apimgmt-api-versioning",
      "name": "API Versioning Pattern",
      "description": "Version APIs properly",
      "scenario": "API evolution",
      "code": {
        "versioning": "Version APIs:\n- URL: /api/v1/resource\n- Header: API-Version: 1.0\n- Query: ?version=1.0"
      },
      "use_when": "When API evolution",
      "code_example": "Version APIs:\n- URL: /api/v1/resource\n- Header: API-Version: 1.0\n- Query: ?version=1.0",
      "best_practices": [
        "Use URL versioning",
        "Support multiple versions",
        "Deprecate old versions",
        "Document versioning strategy"
      ]
    },
    "apimgmt-analytics": {
      "id": "apimgmt-analytics",
      "name": "Analytics Pattern",
      "description": "Monitor API usage This pattern supports SAP Analytics Pattern integration and implementation.",
      "scenario": "All APIs",
      "code": {
        "analytics": "Monitor:\n- Request count\n- Response times\n- Error rates\n- Top consumers\n- Geographic distribution"
      },
      "use_when": "When implementing Analytics Pattern or when Monitor API usage This pattern supports SAP Analytics Pattern integration and im",
      "code_example": "Monitor:\n- Request count\n- Response times\n- Error rates\n- Top consumers\n- Geographic distribution",
      "best_practices": [
        "Enable analytics",
        "Monitor key metrics",
        "Set up alerts",
        "Analyze usage patterns"
      ]
    },
    "apimgmt-odata-patterns": {
      "id": "apimgmt-odata-patterns",
      "name": "OData API Pattern",
      "description": "Expose OData services",
      "scenario": "SAP OData services",
      "code": {
        "odata": "OData API:\n- Base path: /odata/v4\n- Service: TravelBookingService\n- Entities: TravelBooking, TravelBookingItem"
      },
      "use_when": "When SAP OData services",
      "code_example": "OData API:\n- Base path: /odata/v4\n- Service: TravelBookingService\n- Entities: TravelBooking, TravelBookingItem",
      "best_practices": [
        "Use OData V4",
        "Follow OData conventions",
        "Support $filter, $select, $expand",
        "Document OData service"
      ]
    },
    "apimgmt-api-key": {
      "id": "apimgmt-api-key",
      "name": "API Key Pattern",
      "description": "Use API keys for authentication",
      "scenario": "Simple authentication",
      "code": {
        "policy": "<VerifyAPIKey async=\"false\" name=\"VerifyAPIKey\">\n  <APIKey ref=\"request.header.apikey\"/>\n</VerifyAPIKey>"
      },
      "use_when": "When Simple authentication",
      "code_example": "<VerifyAPIKey async=\"false\" name=\"VerifyAPIKey\">\n  <APIKey ref=\"request.header.apikey\"/>\n</VerifyAPIKey>",
      "best_practices": [
        "Use API keys for simple auth",
        "Store keys securely",
        "Rotate keys regularly",
        "Use OAuth for better security"
      ]
    },
    "apimgmt-ip-whitelist": {
      "id": "apimgmt-ip-whitelist",
      "name": "IP Whitelist Pattern",
      "description": "Restrict access by IP",
      "scenario": "Internal APIs",
      "code": {
        "policy": "<IPAccessControl async=\"false\" name=\"IPWhitelist\">\n  <IPRules>\n    <Rule action=\"ALLOW\">192.168.1.0/24</Rule>\n  </IPRules>\n</IPAccessControl>"
      },
      "use_when": "When Internal APIs",
      "code_example": "<IPAccessControl async=\"false\" name=\"IPWhitelist\">\n  <IPRules>\n    <Rule action=\"ALLOW\">192.168.1.0/24</Rule>\n  </IPRules>\n</IPAccessControl>",
      "best_practices": [
        "Use IP whitelist for internal APIs",
        "Configure CIDR blocks",
        "Test IP restrictions",
        "Document allowed IPs"
      ]
    },
    "apimgmt-request-validation": {
      "id": "apimgmt-request-validation",
      "name": "Request Validation Pattern",
      "description": "Validate request payload",
      "scenario": "All APIs",
      "code": {
        "policy": "<JSONToXML async=\"false\" name=\"ValidateJSON\">\n  <Options>\n    <Options>\n      <Source>request</Source>\n      <OutputVariable>jsonPayload</OutputVariable>\n    </Options>\n  </Options>\n</JSONToXML>"
      },
      "use_when": "When implementing Request Validation Pattern or when Validate request payload",
      "code_example": "<JSONToXML async=\"false\" name=\"ValidateJSON\">\n  <Options>\n    <Options>\n      <Source>request</Source>\n      <OutputVariable>jsonPayload</OutputVariable>\n    </Options>\n  </Options>\n</JSONToXML>",
      "best_practices": [
        "Validate request format",
        "Check required fields",
        "Validate data types",
        "Return clear error messages"
      ]
    },
    "apimgmt-response-compression": {
      "id": "apimgmt-response-compression",
      "name": "Response Compression Pattern",
      "description": "Compress API responses",
      "scenario": "Large responses",
      "code": {
        "policy": "<GZIP async=\"false\" name=\"CompressResponse\">\n  <Request>\n    <Header name=\"Accept-Encoding\">gzip</Header>\n  </Request>\n</GZIP>"
      },
      "use_when": "When Large responses",
      "code_example": "<GZIP async=\"false\" name=\"CompressResponse\">\n  <Request>\n    <Header name=\"Accept-Encoding\">gzip</Header>\n  </Request>\n</GZIP>",
      "best_practices": [
        "Enable compression",
        "Support gzip",
        "Compress large responses",
        "Monitor compression ratio"
      ]
    },
    "apimgmt-api-documentation": {
      "id": "apimgmt-api-documentation",
      "name": "API Documentation Pattern",
      "description": "Document APIs properly",
      "scenario": "All APIs",
      "code": {
        "documentation": "Document:\n- Endpoints\n- Request/response formats\n- Authentication\n- Error codes\n- Code samples"
      },
      "use_when": "When implementing API Documentation Pattern or when Document APIs properly",
      "code_example": "Document:\n- Endpoints\n- Request/response formats\n- Authentication\n- Error codes\n- Code samples",
      "best_practices": [
        "Provide complete documentation",
        "Include examples",
        "Document error codes",
        "Keep documentation updated"
      ]
    },
    "apimgmt-api-testing": {
      "id": "apimgmt-api-testing",
      "name": "API Testing Pattern",
      "description": "Test APIs This pattern supports SAP API Testing Pattern integration and implementation.",
      "scenario": "All APIs",
      "code": {
        "testing": "Test:\n- Authentication\n- Request/response formats\n- Error handling\n- Rate limits\n- Policies"
      },
      "use_when": "When implementing API Testing Pattern or when Test APIs This pattern supports SAP API Testing Pattern integration and implemen",
      "code_example": "Test:\n- Authentication\n- Request/response formats\n- Error handling\n- Rate limits\n- Policies",
      "best_practices": [
        "Test all endpoints",
        "Test error scenarios",
        "Test rate limits",
        "Automate testing"
      ]
    },
    "apimgmt-api-monitoring": {
      "id": "apimgmt-api-monitoring",
      "name": "API Monitoring Pattern",
      "description": "Monitor API health This pattern supports SAP API Monitoring Pattern integration and implementation.",
      "scenario": "All APIs",
      "code": {
        "monitoring": "Monitor:\n- API availability\n- Response times\n- Error rates\n- Backend health\n- Policy violations"
      },
      "use_when": "When implementing API Monitoring Pattern or when Monitor API health This pattern supports SAP API Monitoring Pattern integration ",
      "code_example": "Monitor:\n- API availability\n- Response times\n- Error rates\n- Backend health\n- Policy violations",
      "best_practices": [
        "Monitor API health",
        "Set up alerts",
        "Track SLA compliance",
        "Monitor backend systems"
      ]
    },
    "apimgmt-api-lifecycle": {
      "id": "apimgmt-api-lifecycle",
      "name": "API Lifecycle Pattern",
      "description": "Manage API lifecycle",
      "scenario": "API evolution",
      "code": {
        "lifecycle": "Lifecycle stages:\n- Created\n- Published\n- Deprecated\n- Retired"
      },
      "use_when": "When API evolution",
      "code_example": "Lifecycle stages:\n- Created\n- Published\n- Deprecated\n- Retired",
      "best_practices": [
        "Manage API lifecycle",
        "Deprecate gracefully",
        "Provide migration guides",
        "Retire old versions"
      ]
    }
  },
  "best_practices": [
    "Use API proxies for all APIs",
    "Apply security policies (OAuth, Quota, Spike Arrest)",
    "Enable caching for read-heavy APIs",
    "Provide complete API documentation",
    "Monitor API usage and performance",
    "Version APIs properly",
    "Handle errors gracefully",
    "Use API products for grouping",
    "Publish to developer portal",
    "Test APIs thoroughly",
    "Monitor API health",
    "Manage API lifecycle"
  ],
  "anti_patterns": [
    {
      "name": "Missing security policies",
      "problem": "Security vulnerability",
      "fix": "Always apply OAuth and rate limiting policies"
    },
    {
      "name": "No API documentation",
      "problem": "Poor developer experience",
      "fix": "Provide complete API documentation"
    },
    {
      "name": "Not monitoring APIs",
      "problem": "Unable to detect issues",
      "fix": "Enable analytics and monitoring"
    },
    {
      "name": "No error handling",
      "problem": "Poor user experience",
      "fix": "Implement proper error handling policies"
    }
  ]
}
