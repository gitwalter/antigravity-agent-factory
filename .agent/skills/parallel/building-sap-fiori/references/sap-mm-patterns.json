{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "id": "sap-mm-patterns",
  "title": "SAP MM Patterns",
  "name": "SAP MM Patterns",
  "description": "Materials Management procurement, inventory, movement types, tables. S/4 on-prem and R/3/ECC.",
  "version": "1.0.0",
  "category": "sap",
  "axiomAlignment": {
    "A1_verifiability": "Procurement flow (PO\u2192GR\u2192IV) and table structure enable traceable verification",
    "A2_user_primacy": "Procurement process supports user-driven purchasing and inventory control",
    "A3_transparency": "Explicit tables (EKKO, EKPO, MKPF, MSEG) document document structure",
    "A4_non_harm": "Account assignment and FI integration ensure correct postings",
    "A5_consistency": "Unified procurement flow and table usage across MM scenarios"
  },
  "related_skills": [
    "s4-process-guide",
    "integrating-sap-systems"
  ],
  "related_knowledge": [
    "sap-fi-patterns.json",
    "sap-sd-patterns.json",
    "sap-btp-patterns.json"
  ],
  "patterns": {
    "purchase_order": {
      "description": "Purchase order header and items",
      "coreTables": {
        "EKKO": {
          "purpose": "Purchase order header",
          "keyFields": [
            "MANDT",
            "EBELN"
          ]
        },
        "EKPO": {
          "purpose": "Purchase order item",
          "keyFields": [
            "MANDT",
            "EBELN",
            "EBELP"
          ]
        },
        "EKKN": {
          "purpose": "Account assignment in purchasing document"
        }
      },
      "use_when": "When implementing purchase_order or when Purchase order header and items",
      "code_example": "SELECT * FROM EKKO WHERE ... FOR ALL ENTRIES IN @lt_keys. Related: EKPO, EKKN",
      "best_practices": [
        "Follow procurement process: Purchase Order \u2192 Goods Receipt \u2192 Invoice Verification",
        "Use EKKO/EKPO for purchase orders",
        "Use MKPF/MSEG for material documents",
        "Verify table/field via SAP Help MCP"
      ]
    },
    "material_document": {
      "description": "Material document for goods movements",
      "coreTables": {
        "MKPF": {
          "purpose": "Material document header"
        },
        "MSEG": {
          "purpose": "Material document item"
        }
      },
      "use_when": "When implementing material_document or when Material document for goods movements",
      "code_example": "SELECT * FROM MKPF WHERE ... FOR ALL ENTRIES IN @lt_keys. Related: MSEG",
      "best_practices": [
        "Follow procurement process: Purchase Order \u2192 Goods Receipt \u2192 Invoice Verification",
        "Use EKKO/EKPO for purchase orders",
        "Use MKPF/MSEG for material documents",
        "Verify table/field via SAP Help MCP"
      ]
    },
    "invoice_receipt": {
      "description": "Invoice receipt in MM-IV",
      "coreTables": {
        "RSEG": {
          "purpose": "Invoice receipt (MM-IV)"
        }
      },
      "use_when": "When implementing invoice_receipt or when Invoice receipt in MM-IV",
      "code_example": "SELECT * FROM RSEG WHERE ...",
      "best_practices": [
        "Follow procurement process: Purchase Order \u2192 Goods Receipt \u2192 Invoice Verification",
        "Use EKKO/EKPO for purchase orders",
        "Use MKPF/MSEG for material documents",
        "Verify table/field via SAP Help MCP"
      ]
    },
    "procurement_process": {
      "description": "Procurement process flow: PO \u2192 GR \u2192 Invoice verification",
      "process": {
        "procurement": "PO \u2192 GR \u2192 Invoice verification",
        "integration": [
          "FI",
          "EWM"
        ]
      },
      "use_when": "When implementing procurement_process or when Procurement process flow: PO \u2192 GR \u2192 Invoice verification",
      "code_example": "SELECT * FROM ekko WHERE ebeln = @lv_ebeln FOR ALL ENTRIES IN @lt_matnr",
      "best_practices": [
        "Follow procurement process: Purchase Order \u2192 Goods Receipt \u2192 Invoice Verification",
        "Use EKKO/EKPO for purchase orders",
        "Use MKPF/MSEG for material documents",
        "Verify table/field via SAP Help MCP"
      ]
    },
    "scheduling_agreements": {
      "description": "Long-term supplier agreements with plant-specific delivery schedules. LP (without release) and LPA (with release). FRC forecast and JIT delivery schedules. Release creation profiles define when releases are created.",
      "coreTables": {
        "EKKO": {
          "purpose": "Header (BSTYP=L)",
          "keyFields": [
            "EBELN"
          ]
        },
        "EKET": {
          "purpose": "Schedule lines"
        }
      },
      "use_when": "Long-term agreements, JIT/VMI, or forecast-based procurement from known suppliers.",
      "code_example": "SELECT ebeln, bstyp FROM ekko WHERE bstyp = 'L' AND loekz = '' FOR ALL ENTRIES IN @lt_plants. Check EKET for schedule lines.",
      "best_practices": [
        "Define release creation profiles (ME32L) for automatic release generation from forecast",
        "Use LP vs LPA doc types: LPA when release approval workflow is required"
      ]
    },
    "contract_management": {
      "description": "Outline agreements and centrally negotiated contracts. Reference from scheduling agreements. Agreed prices stored on contract.",
      "coreTables": {
        "EKKO": {
          "purpose": "Contract header (BSTYP=K)",
          "keyFields": [
            "EBELN"
          ]
        },
        "EKPO": {
          "purpose": "Contract items and agreed prices"
        }
      },
      "use_when": "Central purchasing, framework agreements, or price negotiations valid across plants.",
      "code_example": "SELECT ebeln, bstae FROM ekko WHERE bstyp = 'K'. Reference EBELN in scheduling agreement KONNR field.",
      "best_practices": [
        "Link scheduling agreements to contracts via reference document for price inheritance",
        "Use outline agreements for quantities; contracts for values and prices"
      ]
    },
    "release_strategy": {
      "description": "Classification-based approval for purchasing documents. Org level and amount thresholds. Multi-level release groups.",
      "use_when": "Documents require approval workflow based on value, material type, or purchase org.",
      "code_example": "Check RELEASE_STRATEGY in enhancement; use T16FS for release groups. MRBR for release workflow.",
      "best_practices": [
        "Define release groups and strategies per doc type and purchase org",
        "Use amount thresholds (T16FS) for automatic release-level determination"
      ]
    },
    "source_determination": {
      "description": "Automatic vendor determination via source list, quota arrangement, or contract/scheduling agreement reference.",
      "coreTables": {
        "EINA": {
          "purpose": "Source list"
        },
        "EORD": {
          "purpose": "Quota arrangement"
        },
        "A017": {
          "purpose": "Info record (contract)"
        }
      },
      "use_when": "Automatic source selection for requisitions or when multiple sources exist.",
      "code_example": "Source list: EINA-EINE. Quota: EORD. OMBD source determination logic in ME5A/ME21N.",
      "best_practices": [
        "Maintain source list (ME01) for plant/material to control allowed sources",
        "Use quota arrangement when splitting quantities across multiple vendors"
      ]
    },
    "vendor_evaluation": {
      "description": "Scoring by price, quality, delivery, service. Automatic and manual evaluation. Used in source determination.",
      "coreTables": {
        "EKKN": {
          "purpose": "Evaluation data"
        },
        "EINA/EINE": {
          "purpose": "Info record scoring"
        }
      },
      "use_when": "Vendor selection based on performance, or when automatic evaluation influences source determination.",
      "code_example": "ME61/ME63 for evaluation. Table LFM1 stores evaluation key. Consider in source determination.",
      "best_practices": [
        "Define evaluation criteria and weights in customizing for consistent scoring",
        "Run periodic automatic evaluation and reconcile with manual overrides"
      ]
    },
    "gr_ir_clearing": {
      "description": "Goods receipt/invoice receipt account clearing. MR11 for manual clearing. Balance reconciliation between GR/IR and invoices.",
      "coreTables": {
        "BSIS": {
          "purpose": "GR/IR clearing account"
        },
        "BSAK": {
          "purpose": "Cleared items"
        }
      },
      "use_when": "Reconciling GR/IR balances, clearing old open items, or month-end close.",
      "code_example": "Transaction MR11. F.13/F.19 for GR/IR analysis. Match BSIS (open) with RSEG/RBKP.",
      "best_practices": [
        "Run frequent GR/IR analysis (F.13) to identify blocking items and aging",
        "Use MR11 for manual clearing only when automatic matching fails"
      ]
    },
    "retail_procurement": {
      "description": "PO management for retail. Allocation table-based procurement. Central purchasing for distribution centers.",
      "use_when": "Retail article master, site hierarchy, or allocation-driven replenishment scenarios.",
      "code_example": "Allocation table (T459) references. Central PO (ME21N) with distribution. Site-specific MRP.",
      "best_practices": [
        "Use allocation tables for article-site-quantity planning in retail",
        "Configure central purchasing org for distribution to sites/stores"
      ]
    }
  },
  "best_practices": [
    "Follow procurement process: Purchase Order \u2192 Goods Receipt \u2192 Invoice Verification",
    "Use EKKO/EKPO for purchase orders",
    "Use MKPF/MSEG for material documents",
    "Verify table/field via SAP Help MCP",
    "Understand integration with FI (postings) and EWM (warehouse movements)"
  ],
  "anti_patterns": [
    {
      "name": "Not following procurement process",
      "problem": "Missing goods receipt or invoice verification",
      "fix": "Follow complete flow: PO \u2192 GR \u2192 Invoice \u2192 FI Posting"
    },
    {
      "name": "Ignoring account assignment",
      "problem": "Missing cost center or G/L account assignment",
      "fix": "Use EKKN for account assignment in purchase orders"
    },
    {
      "name": "Not verifying material document",
      "problem": "Stock discrepancies",
      "fix": "Always verify material documents (MKPF/MSEG) match purchase orders"
    }
  ]
}
