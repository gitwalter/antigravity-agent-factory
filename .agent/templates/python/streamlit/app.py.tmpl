{% from '_macros/python.tmpl' import import_block, function_def, module_docstring %}

{{ module_docstring(
    title=APP_NAME ~ " - Main Streamlit Application",
    description="Main entry point for the Streamlit application.",
    authors=[AUTHOR],
    created=DATE,
    axiom_alignment=[
        "A1 (Verifiability): All data operations are logged and traceable",
        "A3 (Transparency): Clear UI feedback and error messages",
        "A4 (Non-Harm): Input validation prevents invalid operations"
    ]
) }}

{{ import_block([
    {'from': 'streamlit', 'names': [], 'as_name': 'st'},
    {'from': 'logging', 'names': []},
    {'from': 'pathlib', 'names': ['Path']},
    {'from': '.config.settings', 'names': ['get_settings']},
    {'from': '.utils.state', 'names': ['init_session_state']},
    {'from': '.components.sidebar', 'names': ['render_sidebar']},
    {'from': '.components.dashboard', 'names': ['render_dashboard']}
]) }}

# Configure logging
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s"
)
logger = logging.getLogger(__name__)

# Page configuration
st.set_page_config(
    page_title="{{APP_NAME}}",
    page_icon="{{APP_ICON}}",
    layout="{{LAYOUT}}",  # "wide" or "centered"
    initial_sidebar_state="{{SIDEBAR_STATE}}"  # "expanded" or "collapsed"
)

# Initialize settings
settings = get_settings()

# Initialize session state
init_session_state()

{% call function_def('main', [], docstring="Main application entry point.\n\nThis function orchestrates the Streamlit application flow,\nhandling page routing and component rendering.") %}
    logger.info("Starting {{APP_NAME}} application")
    
    try:
        # Render sidebar
        render_sidebar()
        
        # Get current page from query params or default
        page = st.query_params.get("page", "dashboard")
        
        # Route to appropriate page/component
        if page == "dashboard":
            render_dashboard()
        elif page == "{{PAGE_NAME}}":
            # Add more page routing as needed
            # render_{{PAGE_NAME}}()
            pass
        else:
            st.error(f"Unknown page: {page}")
            render_dashboard()
            
    except Exception as e:
        logger.error(f"Error in main application: {e}", exc_info=True)
        st.error(f"An error occurred: {str(e)}")
        st.info("Please refresh the page or contact support if the issue persists.")
{% endcall %}

if __name__ == "__main__":
    main()
